<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Management - ABS AI Hub</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            min-height: 100vh;
            color: #2c3e50;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px 0;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        }
        .header h1 {
            font-size: 2.5rem;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary {
            background: #6c757d;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .asset-section {
            margin-bottom: 40px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .section-header:hover {
            background: rgba(102, 126, 234, 0.15);
        }
        .section-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-icon {
            font-size: 1.2rem;
        }
        .section-count {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .section-toggle {
            font-size: 1.5rem;
            color: #667eea;
            transition: transform 0.3s ease;
        }
        .section-toggle.collapsed {
            transform: rotate(-90deg);
        }
        .section-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .section-content.collapsed {
            max-height: 0;
            margin: 0;
            opacity: 0;
        }
        .asset-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .asset-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        .asset-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        .asset-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
            color: #2c3e50;
        }
        .asset-class {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .asset-description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .asset-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 13px;
        }
        .meta-item {
            background: rgba(102, 126, 234, 0.1);
            padding: 8px;
            border-radius: 6px;
        }
        .meta-label {
            font-weight: 600;
            color: #667eea;
        }
        .meta-value {
            color: #2c3e50;
        }
        .asset-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .policy-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        .policy-title {
            font-size: 12px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            text-transform: uppercase;
        }
        .policy-items {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .policy-tag {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.1);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2c3e50;
            margin: 0;
        }
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close:hover {
            color: #667eea;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Enhanced Form Styles */
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }

        .form-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 18px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .form-help {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
            color: #667eea;
            font-size: 14px;
        }

        .tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            white-space: normal;
            z-index: 1000;
            min-width: 250px;
            max-width: 400px;
            text-align: left;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip:hover::before {
            content: '';
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: #333;
            z-index: 1000;
        }

        .input-with-button {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-with-button .form-input {
            flex: 1;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
            min-width: auto;
        }

        .url-status {
            margin-top: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .url-status.success {
            color: #28a745;
        }

        .url-status.error {
            color: #dc3545;
        }

        .url-status.loading {
            color: #ffc107;
        }

        .input-with-suggestions {
            position: relative;
        }

        .suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 6px 6px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .suggestions.show {
            display: block;
        }

        .suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }

        .suggestion-item:hover {
            background: #f8f9fa;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-loading {
            padding: 12px;
            text-align: center;
            color: #666;
            font-style: italic;
            font-size: 12px;
        }

        .suggestion-group-title {
            padding: 8px 12px;
            background: #f8f9fa;
            font-weight: bold;
            font-size: 11px;
            color: #495057;
            border-bottom: 1px solid #dee2e6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }
        .lifecycle-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .lifecycle-running {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
        }
        .lifecycle-stopped {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        .lifecycle-paused {
            background: rgba(255, 193, 7, 0.1);
            color: #ffc107;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Asset Management</h1>
            <div>
                <button class="btn" onclick="openAddModal()">Add Asset</button>
                <a href="index.html" class="btn btn-secondary">Back to Hub</a>
            </div>
        </div>

        <div id="loading" class="loading">
            <h3>Loading assets...</h3>
        </div>

        <div id="error" class="error" style="display: none;"></div>
        <div id="success" class="success" style="display: none;"></div>

        <div id="assets-container" style="display: none;"></div>
    </div>

    <!-- Add/Edit Asset Modal -->
    <div id="assetModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Add Asset</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <form id="assetForm">
                <!-- Basic Information -->
                <div class="form-section">
                    <h3>Basic Information</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="assetId">
                            Asset ID *
                            <span class="tooltip" data-tooltip="Unique identifier for the asset. Use lowercase with hyphens (e.g., 'contract-reviewer', 'my-app'). This cannot be changed after creation.">‚ÑπÔ∏è</span>
                        </label>
                        <input type="text" id="assetId" class="form-input" required pattern="[a-z0-9-]+" title="Use lowercase letters, numbers, and hyphens only">
                        <div class="form-help">Use lowercase letters, numbers, and hyphens only. Example: contract-reviewer</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="assetName">
                            Name *
                            <span class="tooltip" data-tooltip="Human-readable display name for the asset. This appears in the UI and can be changed anytime.">‚ÑπÔ∏è</span>
                        </label>
                        <input type="text" id="assetName" class="form-input" required>
                        <div class="form-help">Display name shown in the UI. Example: Contract Reviewer</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="assetClass">
                            Class *
                            <span class="tooltip" data-tooltip="Type of asset. Apps are user-facing applications, Services are backend infrastructure, Models are AI models, Tools are utilities, Datasets are data collections, Secrets are credentials.">‚ÑπÔ∏è</span>
                        </label>
                        <select id="assetClass" class="form-select" required>
                            <option value="">Select class...</option>
                            <option value="app">App - User-facing applications</option>
                            <option value="service">Service - Backend infrastructure</option>
                            <option value="model">Model - AI/ML models</option>
                            <option value="tool">Tool - Utility services</option>
                            <option value="dataset">Dataset - Data collections</option>
                            <option value="secret">Secret - Credentials & keys</option>
                        </select>
                        <div class="form-help">Choose the type of asset you're creating</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="assetDescription">
                            Description
                            <span class="tooltip" data-tooltip="Detailed description of what this asset does and its purpose. Helps users understand what the asset is for.">‚ÑπÔ∏è</span>
                        </label>
                        <textarea id="assetDescription" class="form-input form-textarea" rows="3"></textarea>
                        <div class="form-help">Describe what this asset does and its purpose</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="assetUrl">
                            URL
                            <span class="tooltip" data-tooltip="Web URL where this asset can be accessed. For apps, this is usually the main interface URL. For services, this might be an API endpoint.">‚ÑπÔ∏è</span>
                        </label>
                        <div class="input-with-button">
                            <input type="url" id="assetUrl" class="form-input" placeholder="http://localhost:8080">
                            <button type="button" class="btn btn-small" onclick="verifyUrl()">Verify</button>
                        </div>
                        <div class="form-help">Web URL where this asset can be accessed. Click Verify to test if the URL is reachable.</div>
                        <div id="urlStatus" class="url-status"></div>
                    </div>
                </div>

                <!-- Policy Configuration -->
                <div class="form-section">
                    <h3>Policy Configuration</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="allowedModels">
                            Allowed Models
                            <span class="tooltip" data-tooltip="List of AI models this asset is allowed to use. Separate multiple models with commas. Use standard model names like 'llama3.2:latest', 'llama3:8b', etc.">‚ÑπÔ∏è</span>
                        </label>
                        <div class="input-with-suggestions">
                            <input type="text" id="allowedModels" class="form-input" placeholder="llama3.2:latest, llama3.2:7b, llama3:8b">
                            <div class="suggestions" id="modelSuggestions">
                                <div class="suggestion-loading">Loading available models...</div>
                            </div>
                        </div>
                        <div class="form-help">Comma-separated list of allowed AI models. Click suggestions to add them.</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="allowedEmbeddings">
                            Allowed Embeddings
                            <span class="tooltip" data-tooltip="List of embedding models this asset is allowed to use for vector operations. These are used for RAG, similarity search, and document processing.">‚ÑπÔ∏è</span>
                        </label>
                        <div class="input-with-suggestions">
                            <input type="text" id="allowedEmbeddings" class="form-input" placeholder="bge-small-en-v1.5, legal-bert, all-minilm">
                            <div class="suggestions" id="embeddingSuggestions">
                                <div class="suggestion-item" onclick="addEmbeddingSuggestion('bge-small-en-v1.5')">bge-small-en-v1.5</div>
                                <div class="suggestion-item" onclick="addEmbeddingSuggestion('legal-bert')">legal-bert</div>
                                <div class="suggestion-item" onclick="addEmbeddingSuggestion('all-minilm')">all-minilm</div>
                                <div class="suggestion-item" onclick="addEmbeddingSuggestion('sentence-transformers')">sentence-transformers</div>
                            </div>
                        </div>
                        <div class="form-help">Comma-separated list of allowed embedding models for vector operations.</div>
                    </div>
                </div>

                <!-- Default Configuration -->
                <div class="form-section">
                    <h3>Default Configuration</h3>
                    
                    <div class="form-group">
                        <label class="form-label" for="defaultChatModel">
                            Default Chat Model
                            <span class="tooltip" data-tooltip="Default AI model to use for chat/conversation tasks. Must be one of the allowed models listed above.">‚ÑπÔ∏è</span>
                        </label>
                        <input type="text" id="defaultChatModel" class="form-input" placeholder="llama3.2:latest">
                        <div class="form-help">Default model for chat and conversation tasks</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="defaultEmbedModel">
                            Default Embedding Model
                            <span class="tooltip" data-tooltip="Default embedding model to use for vector operations. Must be one of the allowed embeddings listed above.">‚ÑπÔ∏è</span>
                        </label>
                        <input type="text" id="defaultEmbedModel" class="form-input" placeholder="bge-small-en-v1.5">
                        <div class="form-help">Default model for embedding and vector operations</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="defaultProvider">
                            Default Provider
                            <span class="tooltip" data-tooltip="Default AI provider to use. 'Auto' lets the system choose the best available provider. 'Ollama' uses local models, 'OpenAI/vLLM' uses OpenAI-compatible APIs, 'Hugging Face' uses HF models.">‚ÑπÔ∏è</span>
                        </label>
                        <select id="defaultProvider" class="form-select">
                            <option value="">Select provider...</option>
                            <option value="auto">Auto - Let system choose</option>
                            <option value="ollama">Ollama - Local models</option>
                            <option value="openai">OpenAI/vLLM - OpenAI-compatible APIs</option>
                            <option value="huggingface">Hugging Face - HF models</option>
                        </select>
                        <div class="form-help">Default AI provider for this asset</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="embeddingDim">
                            Embedding Dimension
                            <span class="tooltip" data-tooltip="Number of dimensions in the embedding vectors. Common values: 384 (small models), 768 (medium models), 1024+ (large models). Must match the actual model's output dimensions.">‚ÑπÔ∏è</span>
                        </label>
                        <div class="input-with-suggestions">
                            <input type="number" id="embeddingDim" class="form-input" placeholder="384" min="128" max="4096">
                            <div class="suggestions" id="dimSuggestions">
                                <div class="suggestion-item" onclick="setEmbeddingDim(384)">384 (Small models)</div>
                                <div class="suggestion-item" onclick="setEmbeddingDim(768)">768 (Medium models)</div>
                                <div class="suggestion-item" onclick="setEmbeddingDim(1024)">1024 (Large models)</div>
                                <div class="suggestion-item" onclick="setEmbeddingDim(1536)">1536 (OpenAI ada-002)</div>
                            </div>
                        </div>
                        <div class="form-help">Number of dimensions in embedding vectors. Click suggestions for common values.</div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn">Save Asset</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const GATEWAY_URL = 'http://localhost:8081';
        let currentAssets = [];
        let editingAsset = null;

        // Load assets and model suggestions on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadAssets();
            loadModelSuggestions();
        });

        async function loadAssets() {
            try {
                const response = await fetch(`${GATEWAY_URL}/assets`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                currentAssets = await response.json();
                renderAssets();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('assets-container').style.display = 'grid';
            } catch (error) {
                showError(`Failed to load assets: ${error.message}`);
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function loadModelSuggestions() {
            try {
                const response = await fetch(`${GATEWAY_URL}/admin/models`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                const models = data.models || [];
                
                const suggestionsContainer = document.getElementById('modelSuggestions');
                
                if (models.length === 0) {
                    suggestionsContainer.innerHTML = '<div class="suggestion-loading">No models available</div>';
                    return;
                }
                
                // Group models by availability status
                const availableModels = models.filter(m => m.available).map(m => m.name);
                const runningModels = models.filter(m => m.running).map(m => m.name);
                
                let html = '';
                
                if (runningModels.length > 0) {
                    html += '<div class="suggestion-group-title">üü¢ Running Models</div>';
                    runningModels.forEach(model => {
                        html += `<div class="suggestion-item" onclick="addModelSuggestion('${model}')">${model}</div>`;
                    });
                }
                
                if (availableModels.length > 0) {
                    html += '<div class="suggestion-group-title">üì¶ Available Models</div>';
                    availableModels.forEach(model => {
                        if (!runningModels.includes(model)) {
                            html += `<div class="suggestion-item" onclick="addModelSuggestion('${model}')">${model}</div>`;
                        }
                    });
                }
                
                // Add common model names that might not be available yet
                const commonModels = ['llama3.2:latest', 'llama3.2:7b', 'llama3.2:3b', 'llama3:8b', 'llama3:70b'];
                const missingCommon = commonModels.filter(m => !models.some(model => model.name === m));
                
                if (missingCommon.length > 0) {
                    html += '<div class="suggestion-group-title">üí° Common Models (Auto-pull)</div>';
                    missingCommon.forEach(model => {
                        html += `<div class="suggestion-item" onclick="addModelSuggestion('${model}')">${model}</div>`;
                    });
                }
                
                suggestionsContainer.innerHTML = html;
                
            } catch (error) {
                console.error('Error loading model suggestions:', error);
                const suggestionsContainer = document.getElementById('modelSuggestions');
                suggestionsContainer.innerHTML = '<div class="suggestion-loading">Error loading models</div>';
            }
        }

        function renderAssets() {
            const container = document.getElementById('assets-container');
            
            // Group assets by class
            const groupedAssets = currentAssets.reduce((groups, asset) => {
                const className = asset.class || 'other';
                if (!groups[className]) {
                    groups[className] = [];
                }
                groups[className].push(asset);
                return groups;
            }, {});

            // Define section metadata
            const sectionConfig = {
                'app': { icon: 'üì±', title: 'Applications', color: '#667eea' },
                'service': { icon: '‚öôÔ∏è', title: 'Services', color: '#28a745' },
                'model': { icon: 'üß†', title: 'Models', color: '#ffc107' },
                'tool': { icon: 'üîß', title: 'Tools', color: '#17a2b8' },
                'dataset': { icon: 'üìä', title: 'Datasets', color: '#6f42c1' },
                'secret': { icon: 'üîê', title: 'Secrets', color: '#dc3545' },
                'other': { icon: 'üì¶', title: 'Other', color: '#6c757d' }
            };

            // Render sections
            container.innerHTML = Object.keys(groupedAssets).map(className => {
                const assets = groupedAssets[className];
                const config = sectionConfig[className] || sectionConfig['other'];
                
                return `
                    <div class="asset-section">
                        <div class="section-header" onclick="toggleSection('${className}')">
                            <h2 class="section-title">
                                <span class="section-icon">${config.icon}</span>
                                ${config.title}
                                <span class="section-count">${assets.length}</span>
                            </h2>
                            <span class="section-toggle" id="toggle-${className}">‚ñº</span>
                        </div>
                        <div class="section-content" id="content-${className}">
                            ${assets.map(asset => renderAssetCard(asset)).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAssetCard(asset) {
            return `
                <div class="asset-card">
                    <div class="asset-header">
                        <h3 class="asset-title">${asset.name}</h3>
                        <span class="asset-class">${asset.class}</span>
                    </div>
                    <div class="asset-description">${asset.description || 'No description'}</div>
                    <div class="asset-meta">
                        <div class="meta-item">
                            <div class="meta-label">ID</div>
                            <div class="meta-value">${asset.id}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">URL</div>
                            <div class="meta-value">${asset.metadata?.url || 'N/A'}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Lifecycle</div>
                            <div class="meta-value">
                                <span class="lifecycle-badge lifecycle-${asset.lifecycle?.desired || 'stopped'}">
                                    ${asset.lifecycle?.desired || 'stopped'}
                                </span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Owner</div>
                            <div class="meta-value">${asset.owner || 'N/A'}</div>
                        </div>
                    </div>
                    ${asset.policy ? `
                        <div class="policy-section">
                            <div class="policy-title">Policy</div>
                            <div class="policy-items">
                                ${asset.policy.allowed_models ? asset.policy.allowed_models.map(m => 
                                    `<span class="policy-tag">${m}</span>`
                                ).join('') : ''}
                                ${asset.policy.allowed_embeddings ? asset.policy.allowed_embeddings.map(e => 
                                    `<span class="policy-tag">${e}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    ` : ''}
                    <div class="asset-actions">
                        <button class="btn btn-small" onclick="editAsset('${asset.id}')">Edit</button>
                        <button class="btn btn-small btn-success" onclick="setLifecycle('${asset.id}', 'running')">Enable</button>
                        <button class="btn btn-small btn-secondary" onclick="setLifecycle('${asset.id}', 'stopped')">Disable</button>
                        <button class="btn btn-small btn-danger" onclick="deleteAsset('${asset.id}')">Delete</button>
                    </div>
                </div>
            `;
        }

        function toggleSection(className) {
            const content = document.getElementById(`content-${className}`);
            const toggle = document.getElementById(`toggle-${className}`);
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.classList.remove('collapsed');
            } else {
                content.classList.add('collapsed');
                toggle.classList.add('collapsed');
            }
        }

        function openAddModal() {
            editingAsset = null;
            document.getElementById('modalTitle').textContent = 'Add Asset';
            document.getElementById('assetForm').reset();
            document.getElementById('assetModal').style.display = 'block';
        }

        function editAsset(assetId) {
            const asset = currentAssets.find(a => a.id === assetId);
            if (!asset) return;

            editingAsset = asset;
            document.getElementById('modalTitle').textContent = 'Edit Asset';
            document.getElementById('assetId').value = asset.id;
            document.getElementById('assetName').value = asset.name;
            document.getElementById('assetClass').value = asset.class;
            document.getElementById('assetDescription').value = asset.description || '';
            document.getElementById('assetUrl').value = asset.metadata?.url || '';
            document.getElementById('allowedModels').value = asset.policy?.allowed_models?.join(', ') || '';
            document.getElementById('allowedEmbeddings').value = asset.policy?.allowed_embeddings?.join(', ') || '';
            document.getElementById('defaultChatModel').value = asset.policy?.defaults?.chat_model || '';
            document.getElementById('defaultEmbedModel').value = asset.policy?.defaults?.embed_model || '';
            document.getElementById('defaultProvider').value = asset.policy?.defaults?.provider || '';
            document.getElementById('embeddingDim').value = asset.policy?.defaults?.dim || '';
            document.getElementById('assetModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('assetModal').style.display = 'none';
            editingAsset = null;
        }

        document.getElementById('assetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                id: document.getElementById('assetId').value,
                class: document.getElementById('assetClass').value,
                name: document.getElementById('assetName').value,
                description: document.getElementById('assetDescription').value,
                metadata: {
                    url: document.getElementById('assetUrl').value
                },
                policy: {}
            };

            // Parse policy fields
            const allowedModels = document.getElementById('allowedModels').value
                .split(',').map(s => s.trim()).filter(s => s);
            const allowedEmbeddings = document.getElementById('allowedEmbeddings').value
                .split(',').map(s => s.trim()).filter(s => s);

            if (allowedModels.length > 0) formData.policy.allowed_models = allowedModels;
            if (allowedEmbeddings.length > 0) formData.policy.allowed_embeddings = allowedEmbeddings;

            // Add defaults if provided
            const defaults = {};
            const defaultChatModel = document.getElementById('defaultChatModel').value.trim();
            const defaultEmbedModel = document.getElementById('defaultEmbedModel').value.trim();
            const defaultProvider = document.getElementById('defaultProvider').value.trim();
            const embeddingDim = document.getElementById('embeddingDim').value.trim();

            if (defaultChatModel) defaults.chat_model = defaultChatModel;
            if (defaultEmbedModel) defaults.embed_model = defaultEmbedModel;
            if (defaultProvider) defaults.provider = defaultProvider;
            if (embeddingDim) defaults.dim = parseInt(embeddingDim);

            if (Object.keys(defaults).length > 0) {
                formData.policy.defaults = defaults;
            }

            try {
                let response;
                if (editingAsset) {
                    response = await fetch(`${GATEWAY_URL}/admin/assets/${editingAsset.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                } else {
                    response = await fetch(`${GATEWAY_URL}/admin/assets`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                }

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                showSuccess(editingAsset ? 'Asset updated successfully' : 'Asset created successfully');
                closeModal();
                loadAssets();
            } catch (error) {
                showError(`Failed to save asset: ${error.message}`);
            }
        });

        async function setLifecycle(assetId, desired) {
            try {
                const response = await fetch(`${GATEWAY_URL}/admin/assets/${assetId}/lifecycle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ desired })
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                showSuccess(`Asset ${desired} successfully`);
                loadAssets();
            } catch (error) {
                showError(`Failed to update lifecycle: ${error.message}`);
            }
        }

        async function deleteAsset(assetId) {
            if (!confirm(`Are you sure you want to delete asset "${assetId}"?`)) return;

            try {
                const response = await fetch(`${GATEWAY_URL}/admin/assets/${assetId}`, {
                    method: 'DELETE'
                });

                if (!response.ok) {
                    const error = await response.text();
                    throw new Error(error);
                }

                showSuccess('Asset deleted successfully');
                loadAssets();
            } catch (error) {
                showError(`Failed to delete asset: ${error.message}`);
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('success');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
        }

        // Enhanced functionality functions
        async function verifyUrl() {
            const urlInput = document.getElementById('assetUrl');
            const urlStatus = document.getElementById('urlStatus');
            const url = urlInput.value.trim();
            
            if (!url) {
                urlStatus.textContent = 'Please enter a URL first';
                urlStatus.className = 'url-status error';
                return;
            }
            
            urlStatus.textContent = 'Verifying...';
            urlStatus.className = 'url-status loading';
            
            try {
                const response = await fetch(url, { 
                    method: 'HEAD',
                    mode: 'no-cors',
                    timeout: 5000
                });
                
                urlStatus.textContent = '‚úÖ URL is reachable';
                urlStatus.className = 'url-status success';
            } catch (error) {
                urlStatus.textContent = '‚ùå URL is not reachable';
                urlStatus.className = 'url-status error';
            }
        }

        function addModelSuggestion(model) {
            const input = document.getElementById('allowedModels');
            const currentValue = input.value.trim();
            
            if (currentValue === '') {
                input.value = model;
            } else if (!currentValue.includes(model)) {
                input.value = currentValue + ', ' + model;
            }
            
            input.focus();
        }

        function addEmbeddingSuggestion(embedding) {
            const input = document.getElementById('allowedEmbeddings');
            const currentValue = input.value.trim();
            
            if (currentValue === '') {
                input.value = embedding;
            } else if (!currentValue.includes(embedding)) {
                input.value = currentValue + ', ' + embedding;
            }
            
            input.focus();
        }

        function setEmbeddingDim(dim) {
            document.getElementById('embeddingDim').value = dim;
        }

        // Show/hide suggestions on focus
        document.addEventListener('DOMContentLoaded', function() {
            const modelInput = document.getElementById('allowedModels');
            const embeddingInput = document.getElementById('allowedEmbeddings');
            const dimInput = document.getElementById('embeddingDim');
            
            if (modelInput) {
                modelInput.addEventListener('focus', function() {
                    document.getElementById('modelSuggestions').classList.add('show');
                });
                
                modelInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        document.getElementById('modelSuggestions').classList.remove('show');
                    }, 200);
                });
            }
            
            if (embeddingInput) {
                embeddingInput.addEventListener('focus', function() {
                    document.getElementById('embeddingSuggestions').classList.add('show');
                });
                
                embeddingInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        document.getElementById('embeddingSuggestions').classList.remove('show');
                    }, 200);
                });
            }
            
            if (dimInput) {
                dimInput.addEventListener('focus', function() {
                    document.getElementById('dimSuggestions').classList.add('show');
                });
                
                dimInput.addEventListener('blur', function() {
                    setTimeout(() => {
                        document.getElementById('dimSuggestions').classList.remove('show');
                    }, 200);
                });
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('assetModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>

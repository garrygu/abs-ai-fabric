<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABS AI Hub - Legal Workstation</title>

    <!-- Tailwind CSS - Required for unified-framework.js header styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Alpine.js for framework interactivity -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>

    <!-- Hub UI Styles (extracted) -->
    <link rel="stylesheet" href="css/hub-styles.css">

</head>

<body>
    <!-- Main Navigation Tabs -->
    <nav class="main-nav">
        <div class="main-nav-container">
            <div class="main-nav-tabs">
                <a href="index.html" class="main-nav-tab active">📂 My Assets</a>
                <a href="app-store.html" class="main-nav-tab">🛒 App Store</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Header and Navigation Tabs Removed -->

        <!-- Apps Tab -->
        <h2>📱 Applications</h2>
        <p>Discover and launch AI-powered applications available in your workspace.</p>

        <!-- Applications -->
        <div class="apps-grid" id="apps-grid">
            <!-- Apps will be loaded dynamically -->
        </div>
    </div>

    <!-- Assets Tab (Merged Admin + Assets) -->
    <div id="assets-tab" class="tab-content">
        <div class="admin-container">
            <!-- Assets Sidebar (Merged from Admin) -->
            <div class="admin-sidebar">
                <h3>Asset Management</h3>
                <ul class="admin-sub-tabs">
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('overview')" class="active">📊 Overview</button>
                    </li>
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('services')">⚙️ Services</button>
                    </li>
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('models')">🧠 Models</button>
                    </li>
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('dependencies')">🔗 Dependencies</button>
                    </li>
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('system')">📈 System</button>
                    </li>
                    <li class="admin-sub-tab">
                        <button onclick="showAssetsSubTab('inspector')">🔍 Data Inspector</button>
                    </li>
                </ul>
            </div>

            <!-- Assets Content (merged Admin content) -->
            <div class="admin-content">
                <!-- Overview Sub-Tab -->
                <div id="overview-sub" class="admin-sub-content active">
                    <h2>📊 System Overview</h2>

                    <!-- Service Status Summary -->
                    <div class="service-summary">
                        <h3>Service Status</h3>
                        <div class="service-status-grid">
                            <div class="status-card">
                                <div class="status-icon">🤖</div>
                                <div class="status-info">
                                    <div class="status-name">Ollama <span class="status-version">v<span
                                                id="ollama-version-summary">-</span></span></div>
                                    <div class="status-indicator" id="ollama-status-summary">Checking...</div>
                                </div>
                            </div>
                            <div class="status-card">
                                <div class="status-icon">🗄️</div>
                                <div class="status-info">
                                    <div class="status-name">Qdrant <span class="status-version">v<span
                                                id="qdrant-version-summary">-</span></span></div>
                                    <div class="status-indicator" id="qdrant-status-summary">Checking...</div>
                                </div>
                            </div>
                            <div class="status-card">
                                <div class="status-icon">⚡</div>
                                <div class="status-info">
                                    <div class="status-name">Redis <span class="status-version">v<span
                                                id="redis-version-summary">-</span></span></div>
                                    <div class="status-indicator" id="redis-status-summary">Checking...</div>
                                </div>
                            </div>
                            <div class="status-card">
                                <div class="status-icon">🐘</div>
                                <div class="status-info">
                                    <div class="status-name">PostgreSQL <span class="status-version">v<span
                                                id="postgresql-version-summary">-</span></span></div>
                                    <div class="status-indicator" id="postgresql-status-summary">Checking...</div>
                                </div>
                            </div>
                            <div class="status-card">
                                <div class="status-icon">🌐</div>
                                <div class="status-info">
                                    <div class="status-name">Hub Gateway <span class="status-version">v<span
                                                id="gateway-version-summary">-</span></span></div>
                                    <div class="status-indicator" id="gateway-status-summary">Checking...</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Asset Statistics -->
                    <div class="asset-overview">
                        <h3>Asset Statistics</h3>
                        <div class="asset-stats">
                            <div class="stat-card">
                                <div class="stat-icon">📱</div>
                                <div class="stat-number" id="app-count">-</div>
                                <div class="stat-label">Applications</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">⚙️</div>
                                <div class="stat-number" id="service-count">-</div>
                                <div class="stat-label">Services</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">🧠</div>
                                <div class="stat-number" id="model-count">-</div>
                                <div class="stat-label">Models</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">🔧</div>
                                <div class="stat-number" id="tool-count">-</div>
                                <div class="stat-label">Tools</div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <a href="manage.html" class="btn btn-primary">Open Asset Manager</a>
                            <button class="btn btn-secondary" onclick="refreshAllStatus()">Refresh All</button>
                            <button class="btn btn-secondary" onclick="restartAllServices()">Restart All
                                Services</button>
                        </div>
                    </div>
                </div>

                <!-- Services Sub-Tab -->
                <div id="services-sub" class="admin-sub-content">
                    <h2>⚙️ Service Management</h2>
                    <div class="services-grid">
                        <div class="service-control-card critical" id="ollama-control">
                            <div class="service-header">
                                <div class="service-info">
                                    <h3>🤖 Ollama (LLM Server)</h3>
                                    <p>Large Language Model serving with lazy-loaded models</p>
                                </div>
                                <div class="service-status">
                                    <span class="status-indicator" id="ollama-status">Checking...</span>
                                    <div class="service-controls">
                                        <button class="icon-btn start" title="Start Service"
                                            onclick="toggleService('ollama', true)">▶️</button>
                                        <button class="icon-btn stop" title="Stop Service"
                                            onclick="toggleService('ollama', false)">⏹️</button>
                                        <button class="icon-btn restart" title="Restart Service"
                                            onclick="restartService('ollama')">♻️</button>
                                    </div>
                                </div>
                            </div>
                            <div class="service-details" id="ollama-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Status</span>
                                        <span class="detail-value" id="ollama-status-text">Checking...</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Models</span>
                                        <span class="detail-value" id="ollama-models">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Memory</span>
                                        <span class="detail-value" id="ollama-memory">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Version</span>
                                        <span class="detail-value" id="ollama-version">-</span>
                                    </div>
                                </div>
                            </div>
                            <button class="expand-btn" onclick="toggleServiceDetails('ollama')">View
                                Details</button>
                        </div>

                        <div class="service-control-card critical" id="qdrant-control">
                            <div class="service-header">
                                <div class="service-info">
                                    <h3>🗄️ Qdrant (Vector Database)</h3>
                                    <p>Vector database for embeddings and similarity search</p>
                                </div>
                                <div class="service-status">
                                    <span class="status-indicator" id="qdrant-status">Checking...</span>
                                    <div class="service-controls">
                                        <button class="icon-btn start" title="Start Service"
                                            onclick="toggleService('qdrant', true)">▶️</button>
                                        <button class="icon-btn stop" title="Stop Service"
                                            onclick="toggleService('qdrant', false)">⏹️</button>
                                        <button class="icon-btn restart" title="Restart Service"
                                            onclick="restartService('qdrant')">♻️</button>
                                    </div>
                                </div>
                            </div>
                            <div class="service-details" id="qdrant-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Status</span>
                                        <span class="detail-value" id="qdrant-status-text">Checking...</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Collections</span>
                                        <span class="detail-value" id="qdrant-collections">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Vectors</span>
                                        <span class="detail-value" id="qdrant-vectors">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Version</span>
                                        <span class="detail-value" id="qdrant-version">-</span>
                                    </div>
                                </div>
                            </div>
                            <button class="expand-btn" onclick="toggleServiceDetails('qdrant')">View
                                Details</button>
                        </div>

                        <div class="service-control-card" id="redis-control">
                            <div class="service-header">
                                <div class="service-info">
                                    <h3>⚡ Redis (Cache)</h3>
                                    <p>In-memory cache for performance optimization</p>
                                </div>
                                <div class="service-status">
                                    <span class="status-indicator" id="redis-status">Checking...</span>
                                    <div class="service-controls">
                                        <button class="icon-btn start" title="Start Service"
                                            onclick="toggleService('redis', true)">▶️</button>
                                        <button class="icon-btn stop" title="Stop Service"
                                            onclick="toggleService('redis', false)">⏹️</button>
                                        <button class="icon-btn restart" title="Restart Service"
                                            onclick="restartService('redis')">♻️</button>
                                    </div>
                                </div>
                            </div>
                            <div class="service-details" id="redis-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Status</span>
                                        <span class="detail-value" id="redis-status-text">Checking...</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Keys</span>
                                        <span class="detail-value" id="redis-keys">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Memory</span>
                                        <span class="detail-value" id="redis-memory">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Version</span>
                                        <span class="detail-value" id="redis-version">-</span>
                                    </div>
                                </div>
                            </div>
                            <button class="expand-btn" onclick="toggleServiceDetails('redis')">View Details</button>
                        </div>

                        <div class="service-control-card critical" id="postgresql-control">
                            <div class="service-header">
                                <div class="service-info">
                                    <h3>🐘 PostgreSQL (Database)</h3>
                                    <p>Relational database for metadata and structured data storage</p>
                                </div>
                                <div class="service-status">
                                    <span class="status-indicator" id="postgresql-status">Checking...</span>
                                    <div class="service-controls">
                                        <button class="icon-btn start" title="Start Service"
                                            onclick="toggleService('postgresql', true)">▶️</button>
                                        <button class="icon-btn stop" title="Stop Service"
                                            onclick="toggleService('postgresql', false)">⏹️</button>
                                        <button class="icon-btn restart" title="Restart Service"
                                            onclick="restartService('postgresql')">♻️</button>
                                    </div>
                                </div>
                            </div>
                            <div class="service-details" id="postgresql-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Status</span>
                                        <span class="detail-value" id="postgresql-status-text">Checking...</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Database Size</span>
                                        <span class="detail-value" id="postgresql-size">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Connections</span>
                                        <span class="detail-value" id="postgresql-connections">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Version</span>
                                        <span class="detail-value" id="postgresql-version">-</span>
                                    </div>
                                </div>
                            </div>
                            <button class="expand-btn" onclick="toggleServiceDetails('postgresql')">View
                                Details</button>
                        </div>

                        <div class="service-control-card" id="gateway-control">
                            <div class="service-header">
                                <div class="service-info">
                                    <h3>🌐 Hub Gateway</h3>
                                    <p>Central API gateway and service orchestrator</p>
                                </div>
                                <div class="service-status">
                                    <span class="status-indicator" id="gateway-status">Checking...</span>
                                    <div class="service-controls">
                                        <button class="icon-btn start" title="Start Service"
                                            onclick="toggleService('gateway', true)">▶️</button>
                                        <button class="icon-btn stop" title="Stop Service"
                                            onclick="toggleService('gateway', false)">⏹️</button>
                                        <button class="icon-btn restart" title="Restart Service"
                                            onclick="restartService('gateway')">♻️</button>
                                    </div>
                                </div>
                            </div>
                            <div class="service-details" id="gateway-details">
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <span class="detail-label">Status</span>
                                        <span class="detail-value" id="gateway-status-text">Checking...</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Version</span>
                                        <span class="detail-value" id="gateway-version">-</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Uptime</span>
                                        <span class="detail-value" id="gateway-uptime">-</span>
                                    </div>
                                </div>
                            </div>
                            <button class="expand-btn" onclick="toggleServiceDetails('gateway')">View
                                Details</button>
                        </div>
                    </div>

                    <!-- Service Operation History -->
                    <div class="operation-history">
                        <h3>📄 Recent Service Operations</h3>
                        <div id="service-operations">
                            <div class="operation-item success">
                                <div class="operation-details">
                                    <div class="operation-service">Hub Gateway</div>
                                    <div class="operation-action">Service started successfully</div>
                                    <div class="operation-timestamp">Just now</div>
                                </div>
                                <span class="operation-status success">Success</span>
                            </div>
                            <div class="operation-item success">
                                <div class="operation-details">
                                    <div class="operation-service">Ollama</div>
                                    <div class="operation-action">Model loaded: llama3.2:latest</div>
                                    <div class="operation-timestamp">2 minutes ago</div>
                                </div>
                                <span class="operation-status success">Success</span>
                            </div>
                            <div class="operation-item warning">
                                <div class="operation-details">
                                    <div class="operation-service">Qdrant</div>
                                    <div class="operation-action">High memory usage detected</div>
                                    <div class="operation-timestamp">5 minutes ago</div>
                                </div>
                                <span class="operation-status warning">Warning</span>
                            </div>
                        </div>
                    </div>

                    <!-- Service Logs -->
                    <div class="logs-section">
                        <div class="logs-header">
                            <h4>📄 Service Logs</h4>
                            <div class="logs-controls">
                                <select id="service-log-selector" onchange="loadServiceLogs()">
                                    <option value="ollama">Ollama</option>
                                    <option value="qdrant">Qdrant</option>
                                    <option value="redis">Redis</option>
                                    <option value="gateway">Hub Gateway</option>
                                </select>
                                <button class="btn btn-primary" onclick="refreshServiceLogs()">Refresh</button>
                                <button class="btn btn-secondary" onclick="clearServiceLogs()">Clear</button>
                            </div>
                        </div>
                        <div class="logs-container" id="service-logs">
                            <div class="log-entry">
                                <span class="log-timestamp">[▶️ Loading...]</span>
                                <span class="log-level info">INFO</span>
                                <span class="log-service">SYSTEM</span>
                                <span class="log-message">Select a service to view logs...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Models Sub-Tab -->
                <div id="models-sub" class="admin-sub-content">
                    <h2>🧠 Model Management</h2>
                    <div class="model-management">
                        <div class="model-actions">
                            <button class="btn btn-primary" onclick="refreshModels()">Refresh Models</button>
                            <button class="btn btn-secondary" onclick="loadAllModels()" disabled
                                title="Disabled: Loading all models simultaneously would overwhelm system resources">▶️
                                Load All Models</button>
                            <button class="btn btn-secondary" onclick="clearModelLogs()">Clear Logs</button>
                        </div>
                        <div class="models-grid" id="admin-models-grid">
                            <!-- Models will be loaded here -->
                        </div>

                        <!-- Model Operation Logs -->
                        <div class="logs-section">
                            <div class="logs-header">
                                <h4>📄 Model Operation Logs</h4>
                                <div class="logs-controls">
                                    <button class="btn btn-primary" onclick="refreshModelLogs()">Refresh</button>
                                    <button class="btn btn-secondary" onclick="toggleLogStreaming()">Toggle
                                        Live</button>
                                </div>
                            </div>
                            <div class="logs-container" id="model-logs">
                                <div class="log-entry">
                                    <span class="log-timestamp">[▶️ Loading...]</span>
                                    <span class="log-level info">INFO</span>
                                    <span class="log-service">SYSTEM</span>
                                    <span class="log-message">Initializing model logs...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dependencies Sub-Tab -->
                <div id="dependencies-sub" class="admin-sub-content">
                    <h2>🔗 Service Dependencies</h2>
                    <div class="dependency-graph">
                        <div class="dependency-visualization">
                            <div class="dependency-flow">
                                <!-- Core Services Row -->
                                <div class="service-row">
                                    <div class="service-node">
                                        <div class="node-icon">🤖</div>
                                        <div class="node-label">Ollama</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                    <div class="service-node">
                                        <div class="node-icon">🗄️</div>
                                        <div class="node-label">Qdrant</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                    <div class="service-node">
                                        <div class="node-icon">⚡</div>
                                        <div class="node-label">Redis</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                </div>

                                <!-- Flow Arrow -->
                                <div class="flow-arrow">⬆️</div>

                                <!-- Hub Gateway -->
                                <div class="service-row">
                                    <div class="service-node">
                                        <div class="node-icon">🌐</div>
                                        <div class="node-label">Hub Gateway</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                </div>

                                <!-- Flow Arrow -->
                                <div class="flow-arrow">⬇️</div>

                                <!-- Applications Row -->
                                <div class="service-row">
                                    <div class="service-node">
                                        <div class="node-icon">🤖</div>
                                        <div class="node-label">Onyx</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                    <div class="service-node">
                                        <div class="node-icon">📄</div>
                                        <div class="node-label">Contract Reviewer</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                    <div class="service-node">
                                        <div class="node-icon">🎤</div>
                                        <div class="node-label">RAG PDF Voice</div>
                                        <div class="node-status online">Online</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dependency-info">
                            <h4>Dependency Status</h4>
                            <div class="dependency-list" id="dependency-list">
                                <div class="dep-item">
                                    <span class="dep-service">Contract Reviewer</span>
                                    <span class="dep-depends">→ Hub Gateway</span>
                                    <span class="dep-status healthy">✔ Healthy</span>
                                </div>
                                <div class="dep-item">
                                    <span class="dep-service">Onyx</span>
                                    <span class="dep-depends">→ Hub Gateway, Ollama, Qdrant, Redis</span>
                                    <span class="dep-status healthy">✔ Healthy</span>
                                </div>
                                <div class="dep-item">
                                    <span class="dep-service">RAG PDF Voice</span>
                                    <span class="dep-depends">→ Hub Gateway, Whisper Server</span>
                                    <span class="dep-status healthy">✔ Healthy</span>
                                </div>
                                <div class="dep-item">
                                    <span class="dep-service">Hub Gateway</span>
                                    <span class="dep-depends">→ Ollama, Qdrant, Redis</span>
                                    <span class="dep-status healthy">✔ Healthy</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Sub-Tab -->
                <div id="system-sub" class="admin-sub-content">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>📈 System Monitoring</h2>
                        <button onclick="updateSystemMetrics()" class="btn btn-primary"
                            style="padding: 8px 16px; font-size: 14px;">
                            🔄 Refresh Metrics
                        </button>
                    </div>
                    <div class="system-monitoring">
                        <div class="monitoring-grid">
                            <div class="monitor-card">
                                <h3>System Resources</h3>
                                <div class="resource-item">
                                    <span class="resource-label">CPU Usage:</span>
                                    <span class="resource-value" id="cpu-usage">-</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Memory Usage:</span>
                                    <span class="resource-value" id="memory-usage">-</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Disk Usage:</span>
                                    <span class="resource-value" id="disk-usage">-</span>
                                </div>
                            </div>
                            <div class="monitor-card">
                                <h3>GPU Status</h3>
                                <div id="gpu-info">
                                    <div class="resource-item">
                                        <span class="resource-label">Loading GPU info...</span>
                                    </div>
                                </div>
                            </div>
                            <div class="monitor-card">
                                <h3>Network Status</h3>
                                <div class="resource-item">
                                    <span class="resource-label">Active Connections:</span>
                                    <span class="resource-value" id="active-connections">-</span>
                                </div>
                                <div class="resource-item">
                                    <span class="resource-label">Requests/min:</span>
                                    <span class="resource-value" id="requests-per-minute">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Collection Management -->
                    <div class="monitor-card">
                        <h3>🗄️ Qdrant Collections</h3>
                        <div id="collections-list">
                            <div class="resource-item">
                                <span class="resource-label">▶️ Loading collections...</span>
                                <span class="resource-value">-</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-primary" onclick="refreshCollections()">Refresh
                                Collections</button>
                            <button class="btn btn-secondary" onclick="showCreateCollection()">Create
                                Collection</button>
                        </div>
                    </div>
                </div>

                <!-- Inspector Sub-Tab -->
                <div id="inspector-sub" class="admin-sub-content">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>🔍 Tri-Store Data Inspector</h2>
                        <button onclick="openInspector()" class="btn btn-primary"
                            style="padding: 8px 16px; font-size: 14px;">
                            🔍 Open Inspector
                        </button>
                    </div>
                    <div class="inspector-info">
                        <div class="info-card">
                            <h3>About the Data Inspector</h3>
                            <p>The Tri-Store Data Inspector allows you to inspect and compare document data across
                                all three storage systems:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>PostgreSQL:</strong> Primary metadata and structured data</li>
                                <li><strong>Redis:</strong> Cached data with TTL information</li>
                                <li><strong>Qdrant:</strong> Vector embeddings and search data</li>
                            </ul>
                            <p>Use this tool to:</p>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Verify data consistency across stores</li>
                                <li>Debug missing or inconsistent data</li>
                                <li>Monitor Redis TTL expiration</li>
                                <li>Compare checksums and field differences</li>
                            </ul>
                        </div>
                        <div class="info-card">
                            <h3>Quick Actions</h3>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button onclick="openInspector()" class="btn btn-primary">
                                    🔍 Open Inspector
                                </button>
                                <button onclick="checkInspectorHealth()" class="btn btn-secondary">
                                    ❤️ Health Check
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="assets-list" style="margin-top: 20px; display: none;"></div>
    </div>
    </div>

    <!-- Model Preview Modal -->
    <div id="model-preview-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-model-name">Model Details</h3>
                <button class="modal-close" onclick="closeModelModal()">&times;</button>
            </div>

            <div class="modal-section">
                <h4>Model Information</h4>
                <div class="modal-info-grid">
                    <div class="modal-info-item">
                        <span class="modal-info-label">Name</span>
                        <span class="modal-info-value" id="modal-name">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Type</span>
                        <span class="modal-info-value" id="modal-type">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Status</span>
                        <span class="modal-info-value" id="modal-status">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Provider</span>
                        <span class="modal-info-value" id="modal-provider">-</span>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>Model Parameters</h4>
                <div class="modal-info-grid">
                    <div class="modal-info-item">
                        <span class="modal-info-label">Parameters</span>
                        <span class="modal-info-value" id="modal-parameters">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Context Length</span>
                        <span class="modal-info-value" id="modal-context-length">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Model Size</span>
                        <span class="modal-info-value" id="modal-size">-</span>
                    </div>
                    <div class="modal-info-item">
                        <span class="modal-info-label">Format</span>
                        <span class="modal-info-value" id="modal-format">-</span>
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h4>Usage Information</h4>
                <div class="modal-info-item">
                    <span class="modal-info-label">Used By Applications</span>
                    <span class="modal-info-value" id="modal-used-by">-</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Functions
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Show selected tab content
            const selectedContent = document.getElementById(tabName + '-tab');
            if (selectedContent) {
                selectedContent.classList.add('active');
            }

            // Update tab buttons
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(button => button.classList.remove('active'));

            const clickedTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }

            // ▶️ Load data when specific tabs are shown
            if (tabName === 'apps') {
                loadAppsData();
            } else if (tabName === 'assets') {
                // Load admin/management data when Assets tab is shown
                loadAdminData();
            }
        }

        // Assets Sub-Tab Functions (merged from Admin)
        function showAssetsSubTab(subTabName) {
            // Also support old function name for backward compatibility
            showAdminSubTab(subTabName);
        }

        function showAdminSubTab(subTabName) {
            // Hide all sub-content
            const subContents = document.querySelectorAll('.admin-sub-content');
            subContents.forEach(content => content.classList.remove('active'));

            // Show selected sub-content
            const selectedContent = document.getElementById(subTabName + '-sub');
            if (selectedContent) {
                selectedContent.classList.add('active');
            }

            // Update sidebar buttons
            const subTabButtons = document.querySelectorAll('.admin-sub-tab button');
            subTabButtons.forEach(button => button.classList.remove('active'));

            const clickedButton = document.querySelector(`[onclick="showAdminSubTab('${subTabName}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }

            // ▶️ Load specific data for the sub-tab
            switch (subTabName) {
                case 'overview':
                    loadOverviewData();
                    break;
                case 'services':
                    loadServicesData();
                    break;
                case 'models':
                    loadModelsData();
                    break;
                case 'dependencies':
                    loadDependenciesData();
                    break;
                case 'system':
                    loadSystemData();
                    break;
            }
        }

        async function loadAdminData() {
            // Initialize overview sub-tab by default
            showAdminSubTab('overview');
            await loadOverviewData();
        }

        // Apps Tab Functions
        async function loadAppsData() {
            try {
                const response = await fetch('http://localhost:8081/v1/assets');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                console.log('Apps data response:', data);
                console.log('Data keys:', Object.keys(data));

                const appsGrid = document.getElementById('apps-grid');
                if (!appsGrid) return;

                // Handle different response formats
                let assets = [];
                if (Array.isArray(data)) {
                    // Direct array response (correct format)
                    assets = data;
                } else if (data.value && Array.isArray(data.value)) {
                    // PowerShell wrapped format
                    assets = data.value;
                } else if (data.assets && Array.isArray(data.assets)) {
                    // Legacy format
                    assets = data.assets;
                } else {
                    console.error('Unexpected data format:', data);
                    appsGrid.innerHTML = '<div class="error">Unexpected data format received from server.</div>';
                    return;
                }

                // Filter only app assets
                const apps = assets.filter(asset => asset.class === 'app');

                if (apps.length === 0) {
                    appsGrid.innerHTML = '<div class="no-apps">No applications found in catalog.</div>';
                    return;
                }

                // Generate app cards
                appsGrid.innerHTML = apps.map(app => {
                    const policy = app.policy || {};
                    const allowedModels = policy.allowed_models || [];
                    const allowedEmbeddings = policy.allowed_embeddings || [];

                    // Get app icon based on app ID
                    const getAppIcon = (appId) => {
                        const icons = {
                            'onyx-assistant': '🤖',
                            'contract-reviewer': '📄',
                            'rag-pdf-voice': '🎤',
                            'deposition-summarizer': '📝',
                            'open-webui': '🌐'
                        };
                        return icons[appId] || '📱';
                    };

                    // Generate dependency tags
                    const dependencyTags = [];

                    const appId = app.id;

                    // Add service dependencies
                    if (appId === 'onyx-assistant' || appId === 'rag-pdf-voice') {
                        dependencyTags.push('<span class="dependency-tag service">Qdrant</span>');
                    }
                    if (appId === 'onyx-assistant') {
                        dependencyTags.push('<span class="dependency-tag service">Redis</span>');
                    }

                    // Add model dependencies (show first 3)
                    const allModels = [...allowedModels, ...allowedEmbeddings];
                    allModels.slice(0, 3).forEach(model => {
                        const isEmbedding = allowedEmbeddings.includes(model);
                        dependencyTags.push(`<span class="dependency-tag model">${model}${isEmbedding ? ' (embed)' : ''}</span>`);
                    });

                    if (allModels.length > 3) {
                        dependencyTags.push(`<span class="dependency-tag">+${allModels.length - 3} more</span>`);
                    }

                    const appUrl = app.metadata?.url || `/${appId}/`;

                    return `
                        <div class="app-card">
                            <div class="app-header">
                                <h3>${getAppIcon(appId)} ${app.name}</h3>
                                <span class="app-status offline" id="app-status-${appId}">Checking...</span>
                            </div>
                            <p>${app.description}</p>
                            <div class="app-dependencies">
                                <strong>Dependencies:</strong>
                                <div class="dependency-tags">
                                    ${dependencyTags.join('')}
                                </div>
                            </div>
                            <div class="app-actions">
                                <a href="${appUrl}" class="app-link" target="_blank">Open ${app.name}</a>
                            </div>
                        </div>
                    `;
                }).join('');

                // Check status for each app
                apps.forEach(app => {
                    const appUrl = app.metadata?.url || `/${app.id}/`;
                    checkAppStatus(app.id, appUrl);
                });

            } catch (error) {
                console.error('Error loading apps:', error);
                console.error('Error details:', error.message);
                const appsGrid = document.getElementById('apps-grid');
                if (appsGrid) {
                    appsGrid.innerHTML = `
                        <div class="error">
                            <h3>Failed to load applications</h3>
                            <p>Error: ${error.message}</p>
                            <p>Please check the console for more details.</p>
                            <button onclick="loadAppsData()" class="btn btn-secondary">Retry</button>
                        </div>
                    `;
                }
            }
        }

        async function checkAppStatus(appId, appUrl) {
            console.log(`🔍 Checking status for ${appId} at ${appUrl}`);
            if (!appUrl) return;

            const statusElement = document.getElementById(`app-status-${appId}`);
            if (!statusElement) {
                console.log(`❌ No status element found for ${appId}`);
                return;
            }

            // Skip status checking for apps that are known to cause console errors
            // This prevents console spam while still showing the apps
            const problematicPorts = ['8080']; // Only RAG PDF Voice (port 8080) is problematic
            const isProblematic = problematicPorts.some(port => appUrl.includes(`localhost:${port}`));

            if (isProblematic) {
                // Set a reasonable default status based on the app
                statusElement.textContent = 'Offline'; // These are likely offline
                statusElement.className = 'app-status offline';
                return;
            }

            // For working apps, try to check their actual status
            // Skip health checks for localhost services when accessed from different origin (CORS issues)
            // Only check if we're on localhost accessing localhost services
            const isLocalhostAccess = window.location.hostname === 'localhost' &&
                (appUrl.includes('localhost:8000') || appUrl.includes('localhost:7860') || appUrl.includes('localhost:3200'));

            if (isLocalhostAccess) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000);

                    // Determine the correct health endpoint for each app
                    let healthEndpoint = '/healthz'; // Default
                    if (appUrl.includes('localhost:8000')) {
                        healthEndpoint = '/health'; // Onyx
                    } else if (appUrl.includes('localhost:7860')) {
                        healthEndpoint = '/healthz'; // Contract Reviewer
                    } else if (appUrl.includes('localhost:3200')) {
                        healthEndpoint = '/health'; // Open WebUI
                    }

                    // For cross-origin requests, skip health check to avoid CORS issues
                    // Apps should be accessible through the hub proxy instead
                    const response = await fetch(`${appUrl}${healthEndpoint}`, {
                        method: 'GET',
                        signal: controller.signal,
                        mode: 'cors',
                        credentials: 'omit'
                    });

                    clearTimeout(timeoutId);

                    if (response.ok) {
                        statusElement.textContent = 'Online';
                        statusElement.className = 'app-status online';
                        console.log(`✅ ${appId} is online`);
                    } else {
                        statusElement.textContent = 'Offline';
                        statusElement.className = 'app-status offline';
                        console.log(`❌ ${appId} health check failed: ${response.status}`);
                    }
                } catch (error) {
                    // If CORS error or network error, mark as unknown/checking
                    // Don't show error - it's expected for cross-origin requests
                    if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                        statusElement.textContent = 'Checking...';
                        statusElement.className = 'app-status';
                        // Don't log CORS errors as they're expected
                    } else {
                        statusElement.textContent = 'Offline';
                        statusElement.className = 'app-status offline';
                        console.log(`❌ ${appId} status check error:`, error.message);
                    }
                }
                return;
            }

            // For apps that don't cause issues, try a simple status check
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 2000);

                const response = await fetch(appUrl, {
                    method: 'GET',
                    signal: controller.signal,
                    mode: 'no-cors' // This prevents CORS errors but still shows network errors
                });

                clearTimeout(timeoutId);
                statusElement.textContent = 'Online';
                statusElement.className = 'app-status online';
            } catch (error) {
                // Silently handle errors - don't spam console
                statusElement.textContent = 'Offline';
                statusElement.className = 'app-status offline';
            }
        }

        async function loadOverviewData() {
            await loadAssetOverview();
            await updateServiceSummary();
        }

        async function loadServicesData() {
            await checkServiceStatus();
            await loadServiceOperations();
        }

        async function loadModelsData() {
            await checkModelStatus();
            await loadAdminModels();
        }

        async function loadDependenciesData() {
            await updateDependencyStatus();
        }

        async function loadSystemData() {
            await updateSystemMetrics();
            await loadCollections();

            // Auto-refresh system metrics every 30 seconds
            if (window.systemMetricsInterval) {
                clearInterval(window.systemMetricsInterval);
            }
            window.systemMetricsInterval = setInterval(updateSystemMetrics, 30000);
        }

        async function loadAssetOverview() {
            try {
                const response = await fetch('http://localhost:8081/v1/assets');
                if (response.ok) {
                    const data = await response.json();
                    updateAssetStats(data);
                } else {
                    console.error('Failed to load assets:', response.status);
                }
            } catch (error) {
                console.error('Error loading assets:', error);
            }
        }

        function updateAssetStats(data) {
            const stats = {
                app: 0,
                service: 0,
                model: 0,
                tool: 0
            };

            // Handle different response formats
            let assets = [];
            if (Array.isArray(data)) {
                // Direct array response (correct format)
                assets = data;
            } else if (data.value && Array.isArray(data.value)) {
                // PowerShell wrapped format
                assets = data.value;
            } else if (data.assets && Array.isArray(data.assets)) {
                // Legacy format
                assets = data.assets;
            }

            assets.forEach(asset => {
                if (stats.hasOwnProperty(asset.class)) {
                    stats[asset.class]++;
                }
            });

            document.getElementById('app-count').textContent = stats.app;
            document.getElementById('service-count').textContent = stats.service;
            document.getElementById('model-count').textContent = stats.model;
            document.getElementById('tool-count').textContent = stats.tool;
        }

        async function updateServiceSummary() {
            // Update summary status indicators
            const services = ['ollama', 'qdrant', 'redis', 'postgresql', 'gateway'];
            try {
                const resp = await fetch('http://localhost:8081/v1/admin/services/status');
                if (!resp.ok) throw new Error('HTTP ' + resp.status);
                const svc = await resp.json();
                for (const service of services) {
                    const summaryElement = document.getElementById(service + '-status-summary');
                    const versionElement = document.getElementById(service + '-version-summary');
                    const data = svc[service] || {};
                    const isOnline = data.status === 'online';
                    if (summaryElement) {
                        summaryElement.textContent = isOnline ? 'Online' : 'Offline';
                        summaryElement.className = 'status-indicator ' + (isOnline ? 'online' : 'offline');
                    }
                    if (versionElement) {
                        versionElement.textContent = data.version || '-';
                    }
                }
            } catch (e) {
                console.warn('Failed to update service summary', e);
            }
        }

        async function refreshAllStatus() {
            await loadAssetOverview();
            await updateServiceSummary();
        }

        async function restartAllServices() {
            console.log('Restarting all services...');
            await refreshAllStatus();
        }

        // Service Management Functions
        async function checkServiceStatus() {
            try {
                const response = await fetch('http://localhost:8081/v1/admin/services/status');
                if (response.ok) {
                    const services = await response.json();

                    // Update service status indicators and detailed metrics
                    Object.keys(services).forEach(serviceName => {
                        const service = services[serviceName];
                        const isOnline = service.status === 'online';

                        // Update status indicators
                        const statusElement = document.getElementById(serviceName + '-status');
                        const statusTextElement = document.getElementById(serviceName + '-status-text');

                        if (statusElement && statusTextElement) {
                            statusElement.textContent = isOnline ? 'Online' : 'Offline';
                            statusElement.className = `status-indicator ${isOnline ? 'online' : 'offline'}`;
                            statusTextElement.textContent = isOnline ? 'Online' : 'Offline';
                        }

                        // Update detailed metrics based on service type
                        if (isOnline) {
                            if (serviceName === 'ollama') {
                                // Update Ollama metrics
                                const modelsElement = document.getElementById('ollama-models');
                                const memoryElement = document.getElementById('ollama-memory');
                                const versionElement = document.getElementById('ollama-version');

                                if (modelsElement) {
                                    modelsElement.textContent = service.model_count || service.models?.length || '0';
                                }
                                if (memoryElement) {
                                    memoryElement.textContent = service.memory_used || '-';
                                }
                                if (versionElement) {
                                    versionElement.textContent = service.version || '-';
                                }
                            } else if (serviceName === 'qdrant') {
                                // Update Qdrant metrics
                                const collectionsElement = document.getElementById('qdrant-collections');
                                const vectorsElement = document.getElementById('qdrant-vectors');
                                const versionElement = document.getElementById('qdrant-version');

                                if (collectionsElement) {
                                    collectionsElement.textContent = service.collection_count || service.collections?.length || '0';
                                }
                                if (vectorsElement) {
                                    vectorsElement.textContent = service.total_vectors || '-';
                                }
                                if (versionElement) {
                                    versionElement.textContent = service.version || '-';
                                }
                            } else if (serviceName === 'redis') {
                                // Update Redis metrics
                                const keysElement = document.getElementById('redis-keys');
                                const memoryElement = document.getElementById('redis-memory');
                                const versionElement = document.getElementById('redis-version');

                                if (keysElement) {
                                    keysElement.textContent = service.keys || '0';
                                }
                                if (memoryElement) {
                                    memoryElement.textContent = service.memory_used || '-';
                                }
                                if (versionElement) {
                                    versionElement.textContent = service.version || '-';
                                }
                            } else if (serviceName === 'postgresql') {
                                // Update PostgreSQL metrics
                                const sizeElement = document.getElementById('postgresql-size');
                                const connectionsElement = document.getElementById('postgresql-connections');
                                const versionElement = document.getElementById('postgresql-version');

                                if (sizeElement) {
                                    sizeElement.textContent = service.database_size || '-';
                                }
                                if (connectionsElement) {
                                    connectionsElement.textContent = service.active_connections || '-';
                                }
                                if (versionElement) {
                                    versionElement.textContent = service.version || '-';
                                }
                            } else if (serviceName === 'gateway') {
                                // Update Gateway metrics
                                const versionElement = document.getElementById('gateway-version');
                                const uptimeElement = document.getElementById('gateway-uptime');

                                if (versionElement) {
                                    versionElement.textContent = service.version || '-';
                                }
                                if (uptimeElement) {
                                    uptimeElement.textContent = service.uptime || '-';
                                }
                            }
                        } else {
                            // Service is offline, reset metrics to dashes
                            const metricElements = [
                                serviceName + '-models', serviceName + '-memory', serviceName + '-version',
                                serviceName + '-collections', serviceName + '-vectors', serviceName + '-keys',
                                serviceName + '-size', serviceName + '-connections', serviceName + '-uptime'
                            ];

                            metricElements.forEach(elementId => {
                                const element = document.getElementById(elementId);
                                if (element) {
                                    element.textContent = '-';
                                }
                            });
                        }
                    });
                } else {
                    console.error('Failed to check service status:', response.status);
                }
            } catch (error) {
                console.error('Error checking service status:', error);
            }
        }

        async function toggleService(serviceName, start) {
            try {
                const action = start ? 'start' : 'stop';
                const response = await fetch(`http://localhost:8081/v1/admin/services/${serviceName}/idle-sleep?action=${action}`, {
                    method: 'POST'
                });

                if (response.ok) {
                    console.log(`Service ${serviceName} ${action} command sent`);
                    // Refresh status after a short delay
                    setTimeout(() => {
                        checkServiceStatus();
                    }, 2000);
                } else {
                    console.error(`Failed to ${action} service ${serviceName}:`, response.status);
                }
            } catch (error) {
                console.error(`Error ${start ? 'starting' : 'stopping'} service ${serviceName}:`, error);
            }
        }

        async function restartService(serviceName) {
            try {
                // First stop the service
                await toggleService(serviceName, false);
                // Wait a bit, then start it
                setTimeout(async () => {
                    await toggleService(serviceName, true);
                }, 3000);
            } catch (error) {
                console.error(`Error restarting service ${serviceName}:`, error);
            }
        }

        function toggleServiceDetails(serviceName) {
            const detailsElement = document.getElementById(`${serviceName}-details`);
            const expandBtn = detailsElement.parentElement.querySelector('.expand-btn');

            if (detailsElement.classList.contains('expanded')) {
                detailsElement.classList.remove('expanded');
                expandBtn.textContent = 'View Details';
            } else {
                detailsElement.classList.add('expanded');
                expandBtn.textContent = 'Hide Details';
            }
        }

        async function refreshAllServices() {
            await checkServiceStatus();
            await checkModelStatus();
        }

        // Model Management Functions
        async function checkModelStatus() {
            try {
                const response = await fetch('http://localhost:8081/v1/admin/models');
                if (response.ok) {
                    const data = await response.json();
                    const models = data.models || [];

                    // Update homepage model displays dynamically
                    updateHomepageModels(models);
                } else {
                    console.error('Failed to check model status:', response.status);
                }
            } catch (error) {
                console.error('Error checking model status:', error);
            }
        }

        function updateHomepageModels(models) {
            // Update LLM models section
            const llmContainer = document.querySelector('#llm-models');
            if (llmContainer) {
                const llmModels = models.filter(m => m.type === 'llm');
                llmContainer.innerHTML = '';

                llmModels.forEach(model => {
                    const modelItem = document.createElement('div');
                    modelItem.className = 'model-item';
                    modelItem.innerHTML = `
                        <span class="model-name">${model.name}</span>
                        <span class="model-status ${model.running ? 'running' : model.available ? 'available' : 'unavailable'}">
                            ${model.running ? 'Running' : model.available ? 'Available' : 'Unavailable'}
                        </span>
                    `;
                    llmContainer.appendChild(modelItem);
                });
            }

            // Update embedding models section
            const embedContainer = document.querySelector('#embedding-models');
            if (embedContainer) {
                const embedModels = models.filter(m => m.type === 'embedding');
                embedContainer.innerHTML = '';

                embedModels.forEach(model => {
                    const modelItem = document.createElement('div');
                    modelItem.className = 'model-item';
                    modelItem.innerHTML = `
                        <span class="model-name">${model.name}</span>
                        <span class="model-status ${model.running ? 'running' : model.available ? 'available' : 'unavailable'}">
                            ${model.running ? 'Running' : model.available ? 'Available' : 'Unavailable'}
                        </span>
                    `;
                    embedContainer.appendChild(modelItem);
                });
            }
        }

        async function loadModelsData() {
            await checkModelStatus();
            await loadAdminModels();
        }

        async function loadDependenciesData() {
            await updateDependencyStatus();
        }

        async function loadSystemData() {
            await updateSystemMetrics();
            await loadCollections();
        }

        // Model Management Functions
        async function refreshModels() {
            await checkModelStatus();
            await loadAdminModels();

            // Clear all error messages when refreshing
            document.querySelectorAll('.model-error-message').forEach(el => {
                el.style.display = 'none';
            });
        }

        const GATEWAY_URL = 'http://localhost:8081';
        // Persist pull state across tab switches
        const PULLING_MODELS_STORAGE_KEY = 'abs_pulling_models';
        let PULLING_MODELS = new Set();
        try {
            const raw = localStorage.getItem(PULLING_MODELS_STORAGE_KEY);
            if (raw) PULLING_MODELS = new Set(JSON.parse(raw));
        } catch (_) { PULLING_MODELS = new Set(); }
        function persistPulling() {
            try { localStorage.setItem(PULLING_MODELS_STORAGE_KEY, JSON.stringify(Array.from(PULLING_MODELS))); } catch (_) { }
        }

        async function pullModel(modelName) {
            try {
                // Hide any previous error message
                hideModelError(modelName);

                const elemId = 'pull-status-' + modelName.replace(/[^a-zA-Z0-9]/g, '');
                // helper to ensure progress nodes exist
                const ensureStatus = (id, text) => {
                    const el = document.getElementById(id);
                    if (!el) return null;
                    el.style.display = 'inline-block';
                    if (!el.querySelector('.pull-text')) {
                        el.innerHTML = '<span class="pull-text"></span><span class="progress-indeterminate"></span>';
                    }
                    el.querySelector('.pull-text').textContent = text;
                    return el;
                };
                let statusEl = ensureStatus(elemId, 'Pulling...');
                // Mark as pulling in persistent set
                PULLING_MODELS.add(modelName);
                persistPulling();
                // Explicitly pull the model first (gateway triggers Ollama /api/pull)
                const resp = await fetch(`${GATEWAY_URL}/admin/models/${encodeURIComponent(modelName)}/pull`, { method: 'POST' });
                if (!resp.ok) throw new Error(await resp.text());
                // Show success and refresh list after a short delay
                statusEl = ensureStatus(elemId, 'Pull requested. This may take a while...');
                setTimeout(() => { refreshModels(); }, 1500);
            } catch (e) {
                console.error('Pull error', e);
                const elemId = 'pull-status-' + modelName.replace(/[^a-zA-Z0-9]/g, '');
                const el = document.getElementById(elemId);
                if (el) {
                    if (!el.querySelector('.pull-text')) {
                        el.innerHTML = '<span class="pull-text"></span>';
                    }
                    el.style.display = 'inline-block';
                    el.querySelector('.pull-text').textContent = 'Failed: ' + (e.message || 'error');
                } else {
                    alert(`Failed to pull ${modelName}: ${e.message}`);
                }

                // Show error message on model card
                showModelError(modelName, `Failed to pull: ${e.message || 'error'}`);

                // Do not keep failed pulls marked as pulling
                PULLING_MODELS.delete(modelName);
                persistPulling();
            }
        }

        async function loadAllModels() {
            // This function is disabled to prevent overwhelming system resources
            addModelLog('warning', 'MODEL', '⚠️ Load All Models is disabled to prevent system overload. Please load models individually as needed.');
            alert('Load All Models is disabled to prevent overwhelming system resources.\n\nPlease load models individually as needed.');
        }

        async function loadAdminModels() {
            try {
                const response = await fetch('http://localhost:8081/admin/models');
                if (response.ok) {
                    const data = await response.json();
                    const models = data.models || [];
                    const summary = data.summary || {};

                    console.log('Enhanced models from API:', models);
                    console.log('Model summary:', summary);

                    const modelsGrid = document.getElementById('admin-models-grid');
                    modelsGrid.innerHTML = '';

                    // Group models by type from catalog
                    const llmModels = models.filter(m => m.type === 'llm');
                    const embeddingModels = models.filter(m => m.type === 'embedding');

                    console.log('LLM models:', llmModels);
                    console.log('Embedding models:', embeddingModels);

                    // Create LLM category
                    if (llmModels.length > 0) {
                        const llmCategory = document.createElement('div');
                        llmCategory.className = 'model-category';
                        llmCategory.innerHTML = `
                            <h3>🧠 Language Models (LLMs)</h3>
                            <div class="model-list"></div>
                        `;
                        const llmList = llmCategory.querySelector('.model-list');

                        llmModels.forEach(model => {
                            const modelItem = document.createElement('div');
                            modelItem.className = 'model-item';

                            // Simplified action buttons - only primary action + info
                            let actionButtons = '';
                            if (model.running) {
                                actionButtons = `
                                    <button class=\"model-btn unload\" onclick=\"unloadModel('${model.name}')\">⏹️ Unload</button>
                                    <button class=\"model-btn delete\" onclick=\"deleteModel('${model.name}')\">🗑️ Delete</button>
                                `;
                            } else if (model.available) {
                                actionButtons = `
                                    <button class=\"model-btn load\" onclick=\"loadModel('${model.name}')\">▶️ Load</button>
                                    <button class=\"model-btn delete\" onclick=\"deleteModel('${model.name}')\">🗑️ Delete</button>
                                `;
                            } else {
                                actionButtons = `
                                    <button class="model-btn pull" onclick="pullModel('${model.name}')">⬇️ Pull</button>
                                    <div class="pull-status" id="pull-status-${model.name.replace(/[^a-zA-Z0-9]/g, '')}" style="display:none;"></div>
                                `;
                            }

                            // Build collapsible usage info
                            let usageInfo = '';
                            if (model.used_by && model.used_by.length > 0) {
                                const usageText = model.used_by.map(u => `${u.name} (${u.type})`).join(', ');
                                const uniqueId = `usage-${model.name.replace(/[^a-zA-Z0-9]/g, '')}`;
                                usageInfo = `
                                    <div class="model-usage">
                                        <button class="used-by-toggle" onclick="toggleUsedBy('${uniqueId}')">
                                            <span>Used by ${model.used_by.length} app${model.used_by.length > 1 ? 's' : ''}</span>
                                            <span id="${uniqueId}-arrow">▼</span>
                                        </button>
                                        <div class="used-by-list hidden" id="${uniqueId}">
                                            ${usageText}
                                        </div>
                                    </div>
                                `;
                            }

                            // Add default indicator
                            let defaultIndicator = '';
                            if (model.is_default_chat) {
                                defaultIndicator = '<span class="model-default">⭐ Default Chat</span>';
                            }

                            // Generate performance tags based on model name
                            let performanceTags = '';
                            const modelName = model.name.toLowerCase();
                            if (modelName.includes('3.2') || modelName.includes('8b')) {
                                performanceTags += '<span class="performance-tag fast">Fast</span>';
                            }
                            if (modelName.includes('legal')) {
                                performanceTags += '<span class="performance-tag legal-tuned">Legal-Tuned</span>';
                            }
                            if (modelName.includes('multilingual') || modelName.includes('bge')) {
                                performanceTags += '<span class="performance-tag multilingual">Multilingual</span>';
                            }

                            // Determine model icon
                            const modelIcon = model.type === 'embedding' ? '📤' : '🧠';

                            modelItem.innerHTML = `
                                <div class="model-main-info">
                                    <div class="model-icon">${modelIcon}</div>
                                    <div class="model-details">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span class="model-name">${model.name}</span>
                                            ${defaultIndicator}
                                            <span class="model-status ${model.running ? 'running' : model.available ? 'available' : 'unavailable'}">
                                                ${model.running ? '✔ Running' : model.available ? '✔ Available' : '✗ Unavailable'}
                                            </span>
                                            <button class="model-btn info" style="margin-left:6px;" onclick="showModelInfo('${model.name}')">ℹ️</button>
                                        </div>
                                        ${performanceTags ? `<div class="model-performance-tags">${performanceTags}</div>` : ''}
                                        ${usageInfo}
                                        <div class="model-error-message" id="error-${model.name.replace(/[^a-zA-Z0-9]/g, '')}" style="display: none;">
                                            <span class="error-text"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="model-actions">
                                    ${actionButtons}
                                </div>
                            `;
                            llmList.appendChild(modelItem);
                            // Restore pull indicator if this model is still pulling
                            const elemId = 'pull-status-' + model.name.replace(/[^a-zA-Z0-9]/g, '');
                            const statusEl = document.getElementById(elemId);
                            if (statusEl && PULLING_MODELS.has(model.name) && !model.available) {
                                statusEl.style.display = 'inline-block';
                                statusEl.querySelector('.pull-text').textContent = 'Pulling...';
                            }
                        });

                        modelsGrid.appendChild(llmCategory);
                    }

                    // Create Embedding category
                    if (embeddingModels.length > 0) {
                        const embedCategory = document.createElement('div');
                        embedCategory.className = 'model-category';
                        embedCategory.innerHTML = `
                            <h3>📤 Embedding Models</h3>
                            <div class="model-list"></div>
                        `;
                        const embedList = embedCategory.querySelector('.model-list');

                        embeddingModels.forEach(model => {
                            const modelItem = document.createElement('div');
                            modelItem.className = 'model-item';

                            // Simplified action buttons - only primary action + info
                            let actionButtons = '';
                            if (model.running) {
                                actionButtons = `
                                    <button class="model-btn unload" onclick="unloadModel('${model.name}')">â¹ï¸ Unload</button>
                                    <button class="model-btn delete" onclick="deleteModel('${model.name}')">ðŸ—‘ï¸ Delete</button>
                                    <button class="model-btn info" onclick="showModelInfo('${model.name}')">â„¹ï¸</button>
                                `;
                            } else if (model.available) {
                                actionButtons = `
                                    <button class="model-btn load" onclick="loadModel('${model.name}')">â–¶ï¸ Load</button>
                                    <button class="model-btn delete" onclick="deleteModel('${model.name}')">ðŸ—‘ï¸ Delete</button>
                                    <button class="model-btn info" onclick="showModelInfo('${model.name}')">â„¹ï¸</button>
                                `;
                            } else {
                                actionButtons = `
                                    <button class="model-btn pull" onclick="pullModel('${model.name}')">â¬‡ï¸ Pull</button>
                                    <div class="pull-status" id="pull-status-${model.name.replace(/[^a-zA-Z0-9]/g, '')}" style="display:none;"></div>
                                `;
                            }

                            // Build collapsible usage info
                            let usageInfo = '';
                            if (model.used_by && model.used_by.length > 0) {
                                const usageText = model.used_by.map(u => `${u.name} (${u.type})`).join(', ');
                                const uniqueId = `usage-${model.name.replace(/[^a-zA-Z0-9]/g, '')}`;
                                usageInfo = `
                                    <div class="model-usage">
                                        <button class="used-by-toggle" onclick="toggleUsedBy('${uniqueId}')">
                                            <span>Used by ${model.used_by.length} app${model.used_by.length > 1 ? 's' : ''}</span>
                                            <span id="${uniqueId}-arrow">â–¼</span>
                                        </button>
                                        <div class="used-by-list hidden" id="${uniqueId}">
                                            ${usageText}
                                        </div>
                                    </div>
                                `;
                            }

                            // Add default indicator
                            let defaultIndicator = '';
                            if (model.is_default_embed) {
                                defaultIndicator = '<span class="model-default">â­ Default Embedding</span>';
                            }

                            // Generate performance tags based on model name
                            let performanceTags = '';
                            const modelName = model.name.toLowerCase();
                            if (modelName.includes('3.2') || modelName.includes('8b')) {
                                performanceTags += '<span class="performance-tag fast">Fast</span>';
                            }
                            if (modelName.includes('legal')) {
                                performanceTags += '<span class="performance-tag legal-tuned">Legal-Tuned</span>';
                            }
                            if (modelName.includes('multilingual') || modelName.includes('bge')) {
                                performanceTags += '<span class="performance-tag multilingual">Multilingual</span>';
                            }

                            // Determine model icon
                            const modelIcon = model.type === 'embedding' ? 'ðŸ”¤' : 'ðŸ§ ';

                            modelItem.innerHTML = `
                                <div class="model-main-info">
                                    <div class="model-icon">${modelIcon}</div>
                                    <div class="model-details">
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span class="model-name">${model.name}</span>
                                            ${defaultIndicator}
                                            <span class="model-status ${model.running ? 'running' : model.available ? 'available' : 'unavailable'}">
                                                ${model.running ? 'âœ“ Running' : model.available ? 'âœ“ Available' : 'âœ— Unavailable'}
                                            </span>
                                        </div>
                                        ${performanceTags ? `<div class="model-performance-tags">${performanceTags}</div>` : ''}
                                        ${usageInfo}
                                        <div class="model-error-message" id="error-${model.name.replace(/[^a-zA-Z0-9]/g, '')}" style="display: none;">
                                            <span class="error-text"></span>
                                        </div>
                                    </div>
                                </div>
                                <div class="model-actions">
                                    ${actionButtons}
                                </div>
                            `;
                            embedList.appendChild(modelItem);
                            // Restore pull indicator if this model is still pulling
                            const elemId = 'pull-status-' + model.name.replace(/[^a-zA-Z0-9]/g, '');
                            const statusEl = document.getElementById(elemId);
                            if (statusEl && PULLING_MODELS.has(model.name) && !model.available) {
                                statusEl.style.display = 'inline-block';
                                statusEl.querySelector('.pull-text').textContent = 'Pulling...';
                            }
                        });

                        modelsGrid.appendChild(embedCategory);
                    }

                    // If no embedding models found, show all models for debugging
                    if (embeddingModels.length === 0 && models.length > 0) {
                        const debugCategory = document.createElement('div');
                        debugCategory.className = 'model-category';
                        debugCategory.innerHTML = `
                            <h3>ðŸ” All Available Models (Debug)</h3>
                            <div class="model-list"></div>
                        `;
                        const debugList = debugCategory.querySelector('.model-list');

                        models.forEach(model => {
                            const modelItem = document.createElement('div');
                            modelItem.className = 'model-item';
                            modelItem.innerHTML = `
                                <span class="model-name">${model.name}</span>
                                <span class="model-status ${model.running ? 'running' : model.available ? 'available' : 'unavailable'}">
                                    ${model.running ? 'Running' : model.available ? 'Available' : 'Unavailable'}
                                </span>
                                <div class="model-actions">
                                    <button class="model-btn info" onclick="showModelInfo('${model.name}')">â„¹ï¸ Info</button>
                                </div>
                            `;
                            debugList.appendChild(modelItem);
                        });

                        modelsGrid.appendChild(debugCategory);
                    }
                } else {
                    console.error('Failed to load admin models:', response.status);
                }
            } catch (error) {
                console.error('Error loading admin models:', error);
            }
        }

        // Dependency Management Functions
        async function updateDependencyStatus() {
            try {
                const response = await fetch('http://localhost:8081/admin/services/status');
                if (response.ok) {
                    const services = await response.json();

                    // Update dependency nodes
                    Object.keys(services).forEach(serviceName => {
                        const nodeElement = document.querySelector(`.service-node.${serviceName}`);
                        if (nodeElement) {
                            const statusElement = nodeElement.querySelector('.node-status');
                            const isOnline = services[serviceName].status === 'online';
                            statusElement.textContent = isOnline ? 'Online' : 'Offline';
                            statusElement.className = `node-status ${isOnline ? 'online' : 'offline'}`;
                        }
                    });
                } else {
                    console.error('Failed to update dependency status:', response.status);
                }
            } catch (error) {
                console.error('Error updating dependency status:', error);
            }
        }

        // Helper function to show error message on model card
        function showModelError(modelName, message) {
            const errorId = 'error-' + modelName.replace(/[^a-zA-Z0-9]/g, '');
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.querySelector('.error-text').textContent = message;
                errorElement.style.display = 'block';
            }
        }

        function hideModelError(modelName) {
            const errorId = 'error-' + modelName.replace(/[^a-zA-Z0-9]/g, '');
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        }

        // Model Operations
        async function loadModel(modelName) {
            try {
                // Hide any previous error message
                hideModelError(modelName);

                addModelLog('info', 'MODEL', `â–¶ï¸ Loading model: ${modelName}`);
                const response = await fetch(`http://localhost:8081/admin/models/${encodeURIComponent(modelName)}/load`, {
                    method: 'POST'
                });
                if (response.ok) {
                    addModelLog('info', 'MODEL', `Model ${modelName} loaded successfully`);
                    setTimeout(() => {
                        refreshModels();
                    }, 2000);
                } else {
                    const errorText = await response.text();
                    addModelLog('error', 'MODEL', `Failed to load model ${modelName}: ${errorText}`);

                    // Show error message on model card
                    try {
                        const errorData = JSON.parse(errorText);
                        const errorMessage = errorData.detail || errorText;
                        showModelError(modelName, errorMessage);
                    } catch {
                        showModelError(modelName, `Failed to load: ${errorText}`);
                    }
                }
            } catch (error) {
                addModelLog('error', 'MODEL', `Error loading model ${modelName}: ${error.message}`);
                showModelError(modelName, `Network error: ${error.message}`);
            }
        }

        async function unloadModel(modelName) {
            try {
                // Hide any previous error message
                hideModelError(modelName);

                addModelLog('info', 'MODEL', `â¹ï¸ Unloading model: ${modelName}`);
                const response = await fetch(`http://localhost:8081/admin/models/${encodeURIComponent(modelName)}/unload`, {
                    method: 'POST'
                });
                if (response.ok) {
                    addModelLog('info', 'MODEL', `Model ${modelName} unloaded successfully`);
                    setTimeout(() => {
                        refreshModels();
                    }, 2000);
                } else {
                    const errorText = await response.text();
                    addModelLog('error', 'MODEL', `Failed to unload model ${modelName}: ${errorText}`);

                    // Show error message on model card
                    try {
                        const errorData = JSON.parse(errorText);
                        const errorMessage = errorData.detail || errorText;
                        showModelError(modelName, errorMessage);
                    } catch {
                        showModelError(modelName, `Failed to unload: ${errorText}`);
                    }
                }
            } catch (error) {
                addModelLog('error', 'MODEL', `Error unloading model ${modelName}: ${error.message}`);
                showModelError(modelName, `Network error: ${error.message}`);
            }
        }

        async function deleteModel(modelName) {
            if (!confirm(`Are you sure you want to delete model "${modelName}"? This action cannot be undone.`)) {
                return;
            }

            try {
                addModelLog('info', 'MODEL', `Deleting model: ${modelName}`);
                // Prefer provider alias if available in the DOM data (stored on the card as data-alias)
                const elId = 'pull-status-' + modelName.replace(/[^a-zA-Z0-9]/g, '');
                const alias = (document.getElementById(elId)?.dataset?.alias) || modelName;
                const response = await fetch(`http://localhost:8081/admin/models/${encodeURIComponent(alias)}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    addModelLog('info', 'MODEL', `Model ${modelName} deleted successfully`);
                    // Refresh immediately to reflect removalX
                    await refreshModels();
                } else {
                    addModelLog('error', 'MODEL', `Failed to delete model ${modelName}: ${response.status}`);
                }
            } catch (error) {
                addModelLog('error', 'MODEL', `Error deleting model ${modelName}: ${error.message}`);
            }
        }

        async function showModelInfo(modelName) {
            try {
                addModelLog('info', 'MODEL', `Opening model preview for: ${modelName}`);

                // Get model details from Ollama
                const response = await fetch(`http://localhost:11434/api/show`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: modelName })
                });

                let modelInfo = {};
                if (response.ok) {
                    modelInfo = await response.json();
                }

                // Get model data from our catalog
                const catalogResponse = await fetch('http://localhost:8081/admin/models');
                let catalogModel = null;
                if (catalogResponse.ok) {
                    const catalogData = await catalogResponse.json();
                    catalogModel = catalogData.models.find(m => m.name === modelName);
                }

                // Populate modal with data
                document.getElementById('modal-model-name').textContent = modelName;
                document.getElementById('modal-name').textContent = modelName;
                document.getElementById('modal-type').textContent = catalogModel?.type || 'Unknown';
                document.getElementById('modal-status').textContent = catalogModel?.running ? 'Running' : catalogModel?.available ? 'Available' : 'Unavailable';
                document.getElementById('modal-provider').textContent = 'Ollama';
                document.getElementById('modal-parameters').textContent = modelInfo.parameter_size || 'Unknown';
                document.getElementById('modal-context-length').textContent = modelInfo.context_length || 'Unknown';
                document.getElementById('modal-size').textContent = modelInfo.size ? (modelInfo.size / 1024 / 1024 / 1024).toFixed(2) + ' GB' : 'Unknown';
                document.getElementById('modal-format').textContent = modelInfo.format || 'Unknown';

                // Usage information
                if (catalogModel?.used_by && catalogModel.used_by.length > 0) {
                    const usageText = catalogModel.used_by.map(u => `${u.name} (${u.type})`).join(', ');
                    document.getElementById('modal-used-by').textContent = usageText;
                } else {
                    document.getElementById('modal-used-by').textContent = 'Not used by any applications';
                }

                // Show modal
                document.getElementById('model-preview-modal').classList.add('active');

            } catch (error) {
                addModelLog('error', 'MODEL', `Error opening model preview for ${modelName}: ${error.message}`);
                alert(`Error loading model information for ${modelName}`);
            }
        }

        function closeModelModal() {
            document.getElementById('model-preview-modal').classList.remove('active');
        }

        // Log Management
        let logStreaming = false;
        let logInterval = null;

        function addModelLog(level, service, message) {
            const logsContainer = document.getElementById('model-logs');
            const timestamp = new Date().toLocaleTimeString();

            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-timestamp">[${timestamp}]</span>
                <span class="log-level ${level}">${level.toUpperCase()}</span>
                <span class="log-service">${service}</span>
                <span class="log-message">${message}</span>
            `;

            logsContainer.insertBefore(logEntry, logsContainer.firstChild);

            // Keep only last 50 log entries
            while (logsContainer.children.length > 50) {
                logsContainer.removeChild(logsContainer.lastChild);
            }
        }

        function clearModelLogs() {
            const logsContainer = document.getElementById('model-logs');
            logsContainer.innerHTML = `
                <div class="log-entry">
                    <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                    <span class="log-level info">INFO</span>
                    <span class="log-service">SYSTEM</span>
                    <span class="log-message">Logs cleared</span>
                </div>
            `;
        }

        function toggleUsedBy(uniqueId) {
            const listElement = document.getElementById(uniqueId);
            const arrowElement = document.getElementById(uniqueId + '-arrow');

            if (listElement.classList.contains('hidden')) {
                listElement.classList.remove('hidden');
                arrowElement.textContent = 'â–²';
            } else {
                listElement.classList.add('hidden');
                arrowElement.textContent = 'â–¼';
            }
        }

        function refreshModelLogs() {
            addModelLog('info', 'SYSTEM', 'Refreshing model logs...');
        }

        function toggleLogStreaming() {
            logStreaming = !logStreaming;
            if (logStreaming) {
                addModelLog('info', 'SYSTEM', 'Live log streaming enabled');
                logInterval = setInterval(() => {
                    // Simulate live logs
                    const randomMessages = [
                        'Model status check completed',
                        'Memory usage: 2.1GB',
                        'Request processed successfully',
                        'Cache hit rate: 85%',
                        'Model inference time: 1.2s'
                    ];
                    const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];
                    addModelLog('debug', 'SYSTEM', randomMessage);
                }, 5000);
            } else {
                addModelLog('info', 'SYSTEM', 'Live log streaming disabled');
                if (logInterval) {
                    clearInterval(logInterval);
                    logInterval = null;
                }
            }
        }

        // Service Logs Functions
        async function loadServiceLogs() {
            const serviceName = document.getElementById('service-log-selector').value;
            try {
                const response = await fetch(`http://localhost:8081/admin/logs/${serviceName}?lines=50`);
                if (response.ok) {
                    const logs = await response.json();
                    updateServiceLogs(logs);
                } else {
                    console.error('Failed to load service logs:', response.status);
                }
            } catch (error) {
                console.error('Error loading service logs:', error);
            }
        }

        function updateServiceLogs(logs) {
            const logsContainer = document.getElementById('service-logs');
            logsContainer.innerHTML = '';

            if (logs && logs.length > 0) {
                logs.forEach(log => {
                    const logEntry = document.createElement('div');
                    logEntry.className = 'log-entry';

                    const timestamp = new Date().toLocaleTimeString();
                    const level = log.level || 'info';
                    const service = log.service || 'UNKNOWN';
                    const message = log.message || log;

                    logEntry.innerHTML = `
                        <span class="log-timestamp">[${timestamp}]</span>
                        <span class="log-level ${level}">${level.toUpperCase()}</span>
                            <span class="log-service">${service}</span>
                        <span class="log-message">${message}</span>
                        `;

                    logsContainer.appendChild(logEntry);
                });
            } else {
                logsContainer.innerHTML = `
                    <div class="log-entry">
                        <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                        <span class="log-level info">INFO</span>
                        <span class="log-service">SYSTEM</span>
                        <span class="log-message">No logs available for this service</span>
                    </div>
                `;
            }
        }

        function refreshServiceLogs() {
            loadServiceLogs();
        }

        function clearServiceLogs() {
            const logsContainer = document.getElementById('service-logs');
            logsContainer.innerHTML = `
                <div class="log-entry">
                    <span class="log-timestamp">[${new Date().toLocaleTimeString()}]</span>
                    <span class="log-level info">INFO</span>
                    <span class="log-service">SYSTEM</span>
                    <span class="log-message">Service logs cleared</span>
                </div>
            `;
        }

        function updateServiceOperations(operations) {
            const operationsContainer = document.getElementById('service-operations');
            operationsContainer.innerHTML = '';

            operations.forEach(op => {
                const operationItem = document.createElement('div');
                operationItem.className = `operation-item ${op.status}`;
                operationItem.innerHTML = `
                    <div class="operation-details">
                        <div class="operation-service">${op.service}</div>
                        <div class="operation-action">${op.action}</div>
                        <div class="operation-timestamp">${op.timestamp}</div>
                    </div>
                    <span class="operation-status ${op.status}">${op.status}</span>
                `;
                operationsContainer.appendChild(operationItem);
            });
        }

        // System Monitoring Functions
        async function updateSystemMetrics() {
            try {
                const response = await fetch('http://localhost:8081/admin/system/metrics');
                if (response.ok) {
                    const metrics = await response.json();

                    // Update system resource displays with proper formatting
                    const cpuElement = document.getElementById('cpu-usage');
                    const memoryElement = document.getElementById('memory-usage');
                    const diskElement = document.getElementById('disk-usage');
                    const connectionsElement = document.getElementById('active-connections');
                    const requestsElement = document.getElementById('requests-per-minute');

                    // Format CPU usage
                    if (cpuElement && metrics.cpu) {
                        cpuElement.textContent = `${metrics.cpu.usage_percent.toFixed(1)}% (${metrics.cpu.cores} cores)`;
                    }

                    // Format Memory usage
                    if (memoryElement && metrics.memory) {
                        const usedGB = (metrics.memory.used / (1024 ** 3)).toFixed(1);
                        const totalGB = (metrics.memory.total / (1024 ** 3)).toFixed(1);
                        memoryElement.textContent = `${metrics.memory.usage_percent.toFixed(1)}% (${usedGB}GB / ${totalGB}GB)`;
                    }

                    // Format Disk usage
                    if (diskElement && metrics.disk) {
                        const usedGB = (metrics.disk.used / (1024 ** 3)).toFixed(1);
                        const totalGB = (metrics.disk.total / (1024 ** 3)).toFixed(1);
                        diskElement.textContent = `${metrics.disk.usage_percent.toFixed(1)}% (${usedGB}GB / ${totalGB}GB)`;
                    }

                    // Format Network (using packets as connection proxy)
                    if (connectionsElement && metrics.network) {
                        const totalPackets = metrics.network.packets_sent + metrics.network.packets_recv;
                        connectionsElement.textContent = totalPackets.toLocaleString();
                    }

                    // Format Network throughput as requests/min proxy
                    if (requestsElement && metrics.network) {
                        const totalBytes = metrics.network.bytes_sent + metrics.network.bytes_recv;
                        const mbPerMin = (totalBytes / (1024 ** 2) / 60).toFixed(1);
                        requestsElement.textContent = `${mbPerMin} MB/min`;
                    }

                    // Update GPU information
                    updateGPUInfo(metrics.gpu, metrics.gpu_debug);
                } else {
                    console.error('Failed to update system metrics:', response.status);
                }
            } catch (error) {
                console.error('Error updating system metrics:', error);
            }
        }

        // GPU Information Functions
        function updateGPUInfo(gpuData, gpuDebug) {
            const gpuInfoElement = document.getElementById('gpu-info');
            if (!gpuInfoElement) return;

            if (!gpuData || gpuData.length === 0) {
                let message = "No GPU detected";
                if (gpuDebug && gpuDebug.error) {
                    if (gpuDebug.error.includes("NVML Shared Library Not Found")) {
                        message = "GPU not accessible from container";
                    } else if (gpuDebug.error.includes("ImportError")) {
                        message = "GPU libraries not available";
                    } else {
                        message = `GPU error: ${gpuDebug.error}`;
                    }
                }

                gpuInfoElement.innerHTML = `
                    <div class="resource-item">
                        <span class="resource-label">${message}</span>
                        <span class="resource-value">-</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-label">Note:</span>
                        <span class="resource-value">Docker container needs GPU access</span>
                    </div>
                `;
                return;
            }

            let gpuHTML = '';
            gpuData.forEach((gpu, index) => {
                const usedGB = (gpu.memory_used / (1024 ** 3)).toFixed(1);
                const totalGB = (gpu.memory_total / (1024 ** 3)).toFixed(1);
                const tempStr = gpu.temperature ? `${gpu.temperature}Â°C` : 'N/A';
                const powerStr = gpu.power_usage ? `${gpu.power_usage.toFixed(1)}W` : 'N/A';

                gpuHTML += `
                    <div class="resource-item">
                        <span class="resource-label">GPU ${gpu.id}: ${gpu.name}</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-label">GPU Utilization:</span>
                        <span class="resource-value">${gpu.utilization.toFixed(1)}%</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-label">GPU Memory:</span>
                        <span class="resource-value">${gpu.memory_utilization.toFixed(1)}% (${usedGB}GB / ${totalGB}GB)</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-label">Temperature:</span>
                        <span class="resource-value">${tempStr}</span>
                    </div>
                    <div class="resource-item">
                        <span class="resource-label">Power Usage:</span>
                        <span class="resource-value">${powerStr}</span>
                    </div>
                `;

                if (index < gpuData.length - 1) {
                    gpuHTML += '<hr style="margin: 10px 0; border: 1px solid #eee;">';
                }
            });

            gpuInfoElement.innerHTML = gpuHTML;
        }

        // Collection Management Functions
        async function loadCollections() {
            try {
                const response = await fetch('http://localhost:6333/collections');
                if (response.ok) {
                    const data = await response.json();
                    const collections = data.result?.collections || [];
                    updateCollectionsList(collections);
                } else {
                    console.error('Failed to load collections:', response.status);
                }
            } catch (error) {
                console.error('Error loading collections:', error);
            }
        }

        function updateCollectionsList(collections) {
            const collectionsList = document.getElementById('collections-list');
            collectionsList.innerHTML = '';

            if (collections.length > 0) {
                collections.forEach(collection => {
                    const collectionItem = document.createElement('div');
                    collectionItem.className = 'resource-item';
                    collectionItem.innerHTML = `
                        <span class="resource-label">${collection.name}</span>
                        <span class="resource-value">
                            ${collection.vectors_count || 0} vectors
                            <button class="model-btn delete" onclick="deleteCollection('${collection.name}')" style="margin-left: 10px;">ðŸ—‘ï¸ Delete</button>
                        </span>
                    `;
                    collectionsList.appendChild(collectionItem);
                });
            } else {
                collectionsList.innerHTML = `
                    <div class="resource-item">
                        <span class="resource-label">No collections found</span>
                        <span class="resource-value">-</span>
                    </div>
                `;
            }
        }

        async function refreshCollections() {
            await loadCollections();
        }

        async function deleteCollection(collectionName) {
            if (!confirm(`Are you sure you want to delete collection "${collectionName}"? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(`http://localhost:8081/admin/collections/${collectionName}`, {
                    method: 'DELETE'
                });
                if (response.ok) {
                    console.log(`Collection ${collectionName} deleted successfully`);
                    await loadCollections();
                } else {
                    console.error(`Failed to delete collection ${collectionName}:`, response.status);
                }
            } catch (error) {
                console.error(`Error deleting collection ${collectionName}:`, error);
            }
        }

        function showCreateCollection() {
            const collectionName = prompt('Enter collection name:');
            if (collectionName) {
                createCollection(collectionName);
            }
        }

        async function createCollection(collectionName) {
            try {
                const response = await fetch('http://localhost:6333/collections', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: collectionName,
                        vectors: {
                            size: 384,
                            distance: 'Cosine'
                        }
                    })
                });
                if (response.ok) {
                    console.log(`Collection ${collectionName} created successfully`);
                    await loadCollections();
                } else {
                    console.error(`Failed to create collection ${collectionName}:`, response.status);
                }
            } catch (error) {
                console.error(`Error creating collection ${collectionName}:`, error);
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ABS AI Hub loaded successfully');

            // Load initial data
            refreshAllServices();
            loadAppsData();
            checkServiceStatus();
            checkModelStatus();

            // Add modal event listeners
            const modal = document.getElementById('model-preview-modal');
            if (modal) {
                // Close modal when clicking outside
                modal.addEventListener('click', function (e) {
                    if (e.target === modal) {
                        closeModelModal();
                    }
                });

                // Close modal with Escape key
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape' && modal.classList.contains('active')) {
                        closeModelModal();
                    }
                });
            }
        });

        async function showAssetsOfType(className) {
            try {
                // Ensure we are on the Assets tab
                showTab('assets');

                const list = document.getElementById('assets-list');
                if (!list) return;
                list.style.display = 'block';
                list.innerHTML = '<div class="loading">Loading ' + className + 's...</div>';

                const response = await fetch('http://localhost:8081/assets');
                if (!response.ok) throw new Error('HTTP ' + response.status);
                const data = await response.json();

                const assets = Array.isArray(data) ? data : (data.assets || data.value || []);
                const filtered = assets.filter(a => a.class === className);

                if (filtered.length === 0) {
                    list.innerHTML = '<div class="error">No ' + className + 's found.</div>';
                    return;
                }

                list.innerHTML = '<div class="assets-grid">' + filtered.map(renderAssetCard).join('') + '</div>';
            } catch (e) {
                const list = document.getElementById('assets-list');
                if (list) list.innerHTML = '<div class="error">Failed to load assets: ' + e.message + '</div>';
            }
        }

        function renderAssetCard(asset) {
            return `
                <div class="asset-card">
                    <div class="asset-header">
                        <h3 class="asset-title">${asset.name}</h3>
                        <span class="asset-class">${asset.class}</span>
                    </div>
                    <div class="asset-description">${asset.description || 'No description'}</div>
                    <div class="asset-meta">
                        <div class="meta-item">
                            <div class="meta-label">ID</div>
                            <div class="meta-value">${asset.id}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">URL</div>
                            <div class="meta-value">${asset.metadata?.url || 'N/A'}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Lifecycle</div>
                            <div class="meta-value">
                                <span class="lifecycle-badge lifecycle-${asset.lifecycle?.desired || 'stopped'}">
                                    ${asset.lifecycle?.desired || 'stopped'}
                                </span>
                            </div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Owner</div>
                            <div class="meta-value">${asset.owner || 'N/A'}</div>
                        </div>
                    </div>
                    ${asset.policy ? `
                        <div class="policy-section">
                            <div class="policy-title">Policy</div>
                            <div class="policy-items">
                                ${asset.policy.allowed_models ? asset.policy.allowed_models.map(m =>
                `<span class="policy-tag">${m}</span>`
            ).join('') : ''}
                                ${asset.policy.allowed_embeddings ? asset.policy.allowed_embeddings.map(e =>
                `<span class="policy-tag">${e}</span>`
            ).join('') : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Inspector Functions
        function openInspector() {
            window.open('inspector.html', '_blank', 'width=1200,height=800,scrollbars=yes,resizable=yes');
        }

        async function checkInspectorHealth() {
            try {
                const response = await fetch('http://localhost:8081/admin/inspector/health');
                const health = await response.json();

                let message = 'Data Store Health Check:\n\n';
                message += `PostgreSQL: ${health.postgres?.status || 'Unknown'}\n`;
                message += `Redis: ${health.redis?.status || 'Unknown'}\n`;
                message += `Qdrant: ${health.qdrant?.status || 'Unknown'}\n`;

                if (health.postgres?.error) message += `\nPostgreSQL Error: ${health.postgres.error}\n`;
                if (health.redis?.error) message += `Redis Error: ${health.redis.error}\n`;
                if (health.qdrant?.error) message += `Qdrant Error: ${health.qdrant.error}\n`;

                alert(message);
            } catch (error) {
                alert('Failed to check inspector health: ' + error.message);
            }
        }
    </script>

    <!-- Hub Framework Configuration -->
    <script src="/hub-framework-config.js"></script>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <p>ABS Legal AI Suite v1.0.0 | Secure On-Prem Deployment</p>
        </div>
    </footer>
</body>

</html>
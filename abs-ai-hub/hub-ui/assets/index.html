<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABS AI Hub - Legal Workstation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f0ff 100%);
            min-height: 100vh;
            color: #2c3e50;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
        }
        .header h1 {
            font-size: 3rem;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .header p {
            font-size: 1.2rem;
            opacity: 0.8;
            margin: 10px 0;
            color: #34495e;
        }
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }
        .app-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        .app-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
            color: #2c3e50;
        }
        .app-card p {
            margin: 0 0 20px 0;
            opacity: 0.8;
            line-height: 1.5;
            color: #34495e;
        }
        .app-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .app-link:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status.online {
            background: #4CAF50;
        }
        .status.offline {
            background: #f44336;
        }
        .core-services {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .core-services h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
        }
        .service-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .service-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .service-card:hover {
            background: rgba(255, 255, 255, 0.95);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s ease;
            color: #2c3e50;
        }
        .service-header:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        .service-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .service-name {
            font-weight: 500;
            font-size: 1rem;
            color: #2c3e50;
        }
        .expand-icon {
            font-size: 0.8rem;
            transition: transform 0.3s ease;
            opacity: 0.7;
        }
        .expand-icon.expanded {
            transform: rotate(180deg);
        }
        .service-details {
            padding: 0 20px 20px 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .detail-label {
            font-weight: 500;
            opacity: 0.8;
            color: #34495e;
        }
        .detail-value {
            font-family: monospace;
            font-weight: 600;
            color: #2c3e50;
            background: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .detail-value.online {
            color: #27ae60;
            background: rgba(39, 174, 96, 0.1);
            border: 1px solid rgba(39, 174, 96, 0.3);
        }
        .detail-value.offline {
            color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }
        .refresh-section {
            text-align: center;
            margin-top: 20px;
        }
        .refresh-btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .refresh-btn:hover {
            background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            gap: 10px;
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.7);
            color: #2c3e50;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        /* Tab Content */
        .tab-content {
            display: none !important;
            min-height: 100vh;
            width: 100%;
            opacity: 0;
            transition: opacity 0.3s ease;
            padding: 20px;
            box-sizing: border-box;
        }

        .tab-content.active {
            display: block !important;
            opacity: 1;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Admin Page Styles */
        .admin-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #333;
            min-height: 200px;
            display: block;
            visibility: visible;
        }

        /* Button States */
        .control-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #ccc !important;
        }

        .model-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            background-color: #ccc !important;
        }

        /* Notification System */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            max-width: 400px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background-color: #4CAF50;
        }

        .notification.error {
            background-color: #f44336;
        }

        .notification.info {
            background-color: #2196F3;
        }

        .admin-section h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.5rem;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .service-control-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .service-control-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .service-info h3 {
            margin: 0 0 5px 0;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .service-info p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .service-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            background: #e74c3c;
            color: white;
        }

        .status-indicator.online {
            background: #27ae60;
        }

        .status-indicator.offline {
            background: #e74c3c;
        }

        .status-indicator.loading {
            background: #f39c12;
        }

        .service-controls {
            display: flex;
            gap: 8px;
        }

        .control-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .start-btn {
            background: #27ae60;
            color: white;
        }

        .start-btn:hover {
            background: #229954;
        }

        .stop-btn {
            background: #e74c3c;
            color: white;
        }

        .stop-btn:hover {
            background: #c0392b;
        }

        .service-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .model-management h4,
        .collection-management h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
            font-size: 1rem;
        }

        .models-list,
        .collections-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .model-item,
        .collection-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
        }

        .model-name,
        .collection-name {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }

        .model-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            background: #e74c3c;
            color: white;
        }

        .model-status.loaded {
            background: #27ae60;
        }

        .model-status.unloaded {
            background: #95a5a6;
        }

        .model-btn,
        .collection-btn {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-btn {
            background: #3498db;
            color: white;
        }

        .unload-btn,
        .delete-btn {
            background: #e74c3c;
            color: white;
        }

        .collection-info {
            color: #7f8c8d;
            font-size: 0.85rem;
            flex: 1;
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .setting-item label {
            font-weight: 600;
            color: #2c3e50;
        }

        .setting-item input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .setting-item p {
            margin: 0;
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .save-settings-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .save-settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        /* Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
        }

        .status-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .status-value {
            font-weight: 600;
            color: #27ae60;
        }

        /* Enhanced Admin Features */
        .monitoring-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .metric-card h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .metric-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .metric-label {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }

        .progress-bar {
            flex: 1;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            transition: width 0.3s ease;
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #f39c12, #e67e22);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #e74c3c, #c0392b);
        }

        .metric-value {
            font-weight: 600;
            color: #27ae60;
            min-width: 50px;
            text-align: right;
        }
        
        .metric-value.enabled {
            color: #10b981;
            font-weight: bold;
        }
        
        .metric-value.disabled {
            color: #6b7280;
        }
        
        .metric-value.running {
            color: #10b981;
            font-weight: bold;
        }
        
        .metric-value.stopped {
            color: #ef4444;
        }
        
        .metric-value.warning {
            color: #f59e0b;
            font-weight: bold;
        }
        
        .metric-value.normal {
            color: #6b7280;
        }
        
        .metric-value.error {
            color: #ef4444;
            font-weight: bold;
        }

        /* Health & Alerts */
        .health-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .health-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .health-card h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .alerts-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.05);
        }

        .alert-item.error {
            background: rgba(231, 76, 60, 0.1);
            border-left: 4px solid #e74c3c;
        }

        .alert-item.warning {
            background: rgba(243, 156, 18, 0.1);
            border-left: 4px solid #f39c12;
        }

        .alert-item.info {
            background: rgba(52, 152, 219, 0.1);
            border-left: 4px solid #3498db;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        .alert-message {
            flex: 1;
            color: #2c3e50;
        }

        .alert-time {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .alert-btn, .health-btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .alert-btn:hover, .health-btn:hover {
            background: #2980b9;
        }

        .health-checks {
            margin-bottom: 15px;
        }

        .health-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            margin-bottom: 8px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
        }

        .health-service {
            font-weight: 600;
            color: #2c3e50;
            min-width: 100px;
        }

        .health-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .health-status.online {
            background: #27ae60;
            color: white;
        }

        .health-status.offline {
            background: #e74c3c;
            color: white;
        }

        .health-latency {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-left: auto;
        }

        /* Analytics & Charts */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .chart-card h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .chart-container {
            margin-bottom: 15px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 8px;
            padding: 10px;
        }

        .chart-controls {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .chart-btn {
            padding: 6px 12px;
            border: 1px solid #ddd;
            background: white;
            color: #2c3e50;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chart-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        .chart-btn:hover {
            background: #ecf0f1;
        }

        .chart-stats {
            display: flex;
            gap: 20px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .stat-value {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        /* Logs Viewer */
        .logs-container {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .logs-header {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .log-selector {
            padding: 6px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            color: #2c3e50;
        }

        .log-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #3498db;
            color: white;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .log-btn:hover {
            background: #2980b9;
        }

        .logs-viewer {
            background: #1e1e1e;
            color: #ffffff;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entry {
            display: flex;
            gap: 15px;
            margin-bottom: 5px;
            padding: 2px 0;
        }

        .log-time {
            color: #888;
            min-width: 150px;
        }

        .log-service {
            color: #4CAF50;
            min-width: 120px;
        }

        .log-level {
            min-width: 60px;
            font-weight: 600;
        }

        .log-level.error {
            color: #f44336;
        }

        .log-level.warn {
            color: #ff9800;
        }

        .log-level.info {
            color: #2196F3;
        }

        .log-message {
            flex: 1;
        }

        /* Backup & Restore */
        .backup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .backup-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .backup-card h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .backup-info, .restore-info {
            margin-bottom: 15px;
        }

        .backup-item, .restore-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .backup-label, .restore-label {
            font-weight: 600;
            color: #2c3e50;
        }

        .backup-value, .restore-value {
            color: #7f8c8d;
        }

        .backup-actions, .restore-actions {
            display: flex;
            gap: 10px;
        }

        .backup-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .backup-btn.primary {
            background: #27ae60;
            color: white;
        }

        .backup-btn.danger {
            background: #e74c3c;
            color: white;
        }

        .backup-btn:not(.primary):not(.danger) {
            background: #3498db;
            color: white;
        }

        .backup-btn:hover {
            opacity: 0.8;
        }

        /* Service Dependencies */
        .dependencies-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .dependency-diagram {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            min-height: 300px;
        }

        .service-node {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #3498db;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-width: 120px;
        }

        .service-node.hub-gateway {
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
        }

        .service-node.ollama {
            top: 120px;
            left: 20px;
        }

        .service-node.qdrant {
            top: 120px;
            right: 20px;
        }

        .service-node.redis {
            top: 200px;
            left: 50%;
            transform: translateX(-50%);
        }

        .service-node.contract-reviewer {
            top: 20px;
            left: 20px;
        }

        .node-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .node-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .node-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 8px;
        }

        .node-status.online {
            background: #27ae60;
            color: white;
        }

        .node-status.offline {
            background: #e74c3c;
            color: white;
        }

        .dependency-arrow {
            position: absolute;
            height: 2px;
            background: #3498db;
            transform-origin: left center;
        }

        .dependency-arrow::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -3px;
            width: 0;
            height: 0;
            border-left: 8px solid #3498db;
            border-top: 4px solid transparent;
            border-bottom: 4px solid transparent;
        }

        .dependency-info {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dependency-info h4 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 1.1rem;
        }

        .dependency-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dep-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
        }

        .dep-service {
            font-weight: 600;
            color: #2c3e50;
            min-width: 120px;
        }

        .dep-depends {
            color: #7f8c8d;
            flex: 1;
        }

        .dep-status {
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .dep-status.healthy {
            background: #27ae60;
            color: white;
        }

        .dep-status.unhealthy {
            background: #e74c3c;
            color: white;
        }
        .models-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .model-category {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .model-category h3 {
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            opacity: 0.9;
            color: #2c3e50;
        }
        .model-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .model-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        .model-name {
            font-weight: 500;
            color: #2c3e50;
        }
        .model-status {
            font-size: 0.8rem;
            padding: 2px 8px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
        }
        .model-status.available {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }
        .model-status.unavailable {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
        }
        .model-status.loading {
            background: rgba(255, 193, 7, 0.3);
            color: #FFC107;
        }
        .app-models {
            display: flex;
            gap: 8px;
            margin: 10px 0 15px 0;
            flex-wrap: wrap;
        }
        .model-badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        .model-badge.llm {
            background: rgba(33, 150, 243, 0.3);
            color: #2196F3;
        }
        .model-badge.embed {
            background: rgba(156, 39, 176, 0.3);
            color: #9C27B0;
        }
        .model-badge.whisper {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ ABS AI Hub</h1>
            <p>Legal Workstation</p>
            <p>AI-powered legal tools and document analysis</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('apps')">üì± Apps</button>
            <button class="nav-tab" onclick="showTab('admin')">‚öôÔ∏è Admin</button>
        </div>

        <!-- Apps Tab -->
        <div id="apps-tab" class="tab-content active">
        <div class="core-services">
            <h2>Core Services Status</h2>
            <div class="service-list">
                <!-- Ollama Service Card -->
                <div class="service-card" id="ollama-card">
                    <div class="service-header" onclick="toggleServiceDetails('ollama')">
                        <div class="service-info">
                            <span class="status online" id="ollama-status-top"></span>
                            <span class="service-name">Ollama (LLM)</span>
                </div>
                        <span class="expand-icon" id="ollama-expand">‚ñº</span>
                </div>
                    <div class="service-details" id="ollama-details" style="display: none;">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="ollama-status-text">Checking...</span>
                </div>
                            <div class="detail-item">
                                <span class="detail-label">Models Loaded:</span>
                                <span class="detail-value" id="ollama-models-count">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">API Version:</span>
                                <span class="detail-value" id="ollama-version">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Memory Usage:</span>
                                <span class="detail-value" id="ollama-memory">Checking...</span>
                            </div>
                        </div>
            </div>
        </div>

                <!-- Qdrant Service Card -->
                <div class="service-card" id="qdrant-card">
                    <div class="service-header" onclick="toggleServiceDetails('qdrant')">
                        <div class="service-info">
                            <span class="status online" id="qdrant-status-top"></span>
                            <span class="service-name">Qdrant (Vector DB)</span>
                        </div>
                        <span class="expand-icon" id="qdrant-expand">‚ñº</span>
                    </div>
                    <div class="service-details" id="qdrant-details" style="display: none;">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="qdrant-status-text">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Collections:</span>
                                <span class="detail-value" id="qdrant-collections">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Total Vectors:</span>
                                <span class="detail-value" id="qdrant-vectors">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">API Version:</span>
                                <span class="detail-value" id="qdrant-version">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Redis Service Card -->
                <div class="service-card" id="redis-card">
                    <div class="service-header" onclick="toggleServiceDetails('redis')">
                        <div class="service-info">
                            <span class="status online" id="redis-status-top"></span>
                            <span class="service-name">Redis (Cache)</span>
                        </div>
                        <span class="expand-icon" id="redis-expand">‚ñº</span>
                    </div>
                    <div class="service-details" id="redis-details" style="display: none;">
                        <div class="detail-grid">
                            <div class="detail-item">
                                <span class="detail-label">Status:</span>
                                <span class="detail-value" id="redis-status-text">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Keys:</span>
                                <span class="detail-value" id="redis-keys">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Memory Used:</span>
                                <span class="detail-value" id="redis-memory">Checking...</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Version:</span>
                                <span class="detail-value" id="redis-version">Checking...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="refresh-section">
                <button class="refresh-btn" onclick="refreshAllServices()">üîÑ Refresh All Services</button>
            </div>
        </div>

        <div class="core-services">
            <h2>Available AI Models</h2>
            <div class="models-grid">
                <div class="model-category">
                    <h3>üß† Language Models (LLMs)</h3>
                    <div class="model-list" id="llm-models">
                        <div class="model-item">
                            <span class="model-name">Llama3.2:3b</span>
                            <span class="model-status unavailable" data-model="llama3.2:3b">Checking...</span>
                        </div>
                        <div class="model-item">
                            <span class="model-name">Llama3.2:7b</span>
                            <span class="model-status unavailable" data-model="llama3.2:latest">Checking...</span>
                        </div>
                        <div class="model-item">
                            <span class="model-name">Llama3:8b</span>
                            <span class="model-status unavailable" data-model="llama3:8b">Checking...</span>
                        </div>
                    </div>
                </div>
                <div class="model-category">
                    <h3>üîç Embedding Models</h3>
                    <div class="model-list" id="embed-models">
                        <div class="model-item">
                            <span class="model-name">Legal-BERT</span>
                            <span class="model-status" data-model="legal-bert">Checking...</span>
                        </div>
                        <div class="model-item">
                            <span class="model-name">BGE Small</span>
                            <span class="model-status" data-model="bge-small-en-v1.5">Checking...</span>
                        </div>
                        <div class="model-item">
                            <span class="model-name">All-MiniLM</span>
                            <span class="model-status" data-model="all-minilm">Checking...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="apps-grid">
            <div class="app-card">
                <h3>ü§ñ Onyx AI Assistant</h3>
                <p>AI assistant with built-in chat interface, RAG capabilities, agent management, and document ingestion. Interact with your knowledge base through natural conversation.</p>
                <div class="app-models">
                    <span class="model-badge llm">Multi-Model</span>
                    <span class="model-badge embed">RAG Engine</span>
                </div>
                <a href="http://localhost:8000/" class="app-link" target="_blank">Open Onyx Chat</a>
            </div>

            <div class="app-card">
                <h3>üåê Open WebUI</h3>
                <p>Advanced alternative chat interface with multi-model support, document attachments, and conversation management. Feature-rich UI for power users.</p>
                <div class="app-models">
                    <span class="model-badge llm">Multi-Model</span>
                    <span class="model-badge embed">RAG Support</span>
                </div>
                <a href="http://localhost:3200/" class="app-link" target="_blank">Open WebUI</a>
            </div>

            <div class="app-card">
                <h3>üìÑ Contract Reviewer</h3>
                <p>Analyze contracts, extract key clauses, flag risks, and produce citation-backed reports. Supports PDF and DOCX documents with OCR capabilities.</p>
                <div class="app-models">
                    <span class="model-badge llm">Llama3.2:7b</span>
                    <span class="model-badge embed">Legal-BERT</span>
                </div>
                <a href="http://localhost:7860/" class="app-link" target="_blank">Open Contract Reviewer</a>
            </div>

            <div class="app-card">
                <h3>üé§ RAG PDF Voice</h3>
                <p>Document analysis with voice interaction capabilities. Process PDFs and interact using natural language queries.</p>
                <div class="app-models">
                    <span class="model-badge llm">Llama3.2:3b</span>
                    <span class="model-badge embed">BGE Small</span>
                </div>
                <a href="/rag/" class="app-link">Open RAG PDF Voice</a>
            </div>
        </div>
        </div>

        <!-- Admin Tab -->
        <div id="admin-tab" class="tab-content">
            <div class="admin-section">
                <h2>üîß Service Management</h2>
                <div class="services-grid">
                    <div class="service-control-card" id="ollama-control">
                        <div class="service-header">
                            <div class="service-info">
                                <h3>Ollama (LLM Server)</h3>
                                <p>Large Language Model serving with lazy-loaded models</p>
                            </div>
                            <div class="service-status">
                                <span class="status-indicator" id="ollama-status">Checking...</span>
                                <div class="service-controls">
                                    <button class="control-btn start-btn" onclick="toggleService('ollama', true)">Start</button>
                                    <button class="control-btn stop-btn" onclick="toggleService('ollama', false)">Stop</button>
                                </div>
                            </div>
                        </div>
                        <div class="service-details" id="ollama-details">
                            <div class="model-management">
                                <h4>Model Management</h4>
                                <div class="models-list" id="ollama-models"></div>
                            </div>
                        </div>
                    </div>

                    <div class="service-control-card" id="qdrant-control">
                        <div class="service-header">
                            <div class="service-info">
                                <h3>Qdrant (Vector Database)</h3>
                                <p>Vector database for embeddings and similarity search</p>
                            </div>
                            <div class="service-status">
                                <span class="status-indicator" id="qdrant-status">Checking...</span>
                                <div class="service-controls">
                                    <button class="control-btn start-btn" onclick="toggleService('qdrant', true)">Start</button>
                                    <button class="control-btn stop-btn" onclick="toggleService('qdrant', false)">Stop</button>
                                </div>
                            </div>
                        </div>
                        <div class="service-details" id="qdrant-details">
                            <div class="collection-management">
                                <h4>Collection Management</h4>
                                <div class="collections-list" id="qdrant-collections">
                                    <div class="collection-item">
                                        <span class="collection-name">legal-bert_vectors</span>
                                        <span class="collection-info">768 dim, 88 vectors</span>
                                        <button class="collection-btn delete-btn" onclick="deleteCollection('legal-bert_vectors')">Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="service-control-card" id="redis-control">
                        <div class="service-header">
                            <div class="service-info">
                                <h3>Redis (Cache)</h3>
                                <p>In-memory cache for performance optimization</p>
                            </div>
                            <div class="service-status">
                                <span class="status-indicator" id="redis-status">Checking...</span>
                                <div class="service-controls">
                                    <button class="control-btn start-btn" onclick="toggleService('redis', true)">Start</button>
                                    <button class="control-btn stop-btn" onclick="toggleService('redis', false)">Stop</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="service-control-card" id="hub-gateway-control">
                        <div class="service-header">
                            <div class="service-info">
                                <h3>Hub Gateway</h3>
                                <p>Central API gateway and service orchestrator</p>
                            </div>
                            <div class="service-status">
                                <span class="status-indicator" id="hub-gateway-status">Checking...</span>
                                <div class="service-controls">
                                    <button class="control-btn start-btn" onclick="toggleService('hub-gateway', true)">Start</button>
                                    <button class="control-btn stop-btn" onclick="toggleService('hub-gateway', false)">Stop</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>‚ö° Auto-Wake Settings</h2>
                <div class="settings-grid">
                    <div class="setting-item">
                        <label for="auto-wake-enabled">Enable Auto-Wake</label>
                        <input type="checkbox" id="auto-wake-enabled" checked>
                        <p>Automatically start services when apps need them</p>
                    </div>
                    <div class="setting-item">
                        <label for="idle-timeout">Idle Timeout (minutes)</label>
                        <input type="number" id="idle-timeout" value="60" min="5" max="480">
                        <p>Auto-stop services after this many minutes of inactivity</p>
                    </div>
                    <div class="setting-item">
                        <label for="model-keep-alive">Model Keep-Alive (hours)</label>
                        <input type="number" id="model-keep-alive" value="2" min="0.5" max="24">
                        <p>How long to keep models loaded in memory</p>
                    </div>
                </div>
                <button class="save-settings-btn" onclick="saveSettings()">Save Settings</button>
            </div>

            <div class="admin-section">
                <h2>üò¥ Idle Sleep Monitoring</h2>
                <div class="monitoring-grid">
                    <div class="metric-card">
                        <h4>‚è∞ Idle Sleep Status</h4>
                        <div class="metric-item">
                            <span class="metric-label">Idle Sleep</span>
                            <span class="metric-value" id="idle-sleep-status">Checking...</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Monitor Task</span>
                            <span class="metric-value" id="monitor-task-status">Checking...</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Idle Timeout</span>
                            <span class="metric-value" id="idle-timeout-display">60 min</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h4>üîÑ Service Idle Status</h4>
                        <div class="metric-item">
                            <span class="metric-label">Ollama Idle</span>
                            <span class="metric-value" id="ollama-idle-status">Checking...</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Qdrant Idle</span>
                            <span class="metric-value" id="qdrant-idle-status">Checking...</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Redis Idle</span>
                            <span class="metric-value" id="redis-idle-status">Checking...</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h4>üß† Model Idle Status</h4>
                        <div class="metric-item">
                            <span class="metric-label">Models Tracked</span>
                            <span class="metric-value" id="models-tracked">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Next Unload</span>
                            <span class="metric-value" id="next-model-unload">None</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Keep-Alive Time</span>
                            <span class="metric-value" id="model-keep-alive-display">2h</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üìä Real-Time Monitoring</h2>
                <div class="monitoring-grid">
                    <div class="metric-card">
                        <h4>üñ•Ô∏è System Resources</h4>
                        <div class="metric-item">
                            <span class="metric-label">GPU Memory</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="gpu-progress" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="gpu-memory">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">System Memory</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="ram-progress" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="system-memory">0%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">CPU Usage</span>
                            <div class="progress-bar">
                                <div class="progress-fill" id="cpu-progress" style="width: 0%"></div>
                            </div>
                            <span class="metric-value" id="cpu-usage">0%</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h4>üåê Network & Connections</h4>
                        <div class="metric-item">
                            <span class="metric-label">Active Connections</span>
                            <span class="metric-value" id="active-connections">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Requests/min</span>
                            <span class="metric-value" id="requests-per-minute">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Response Time</span>
                            <span class="metric-value" id="response-time">0ms</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <h4>ü§ñ AI Models Status</h4>
                        <div class="metric-item">
                            <span class="metric-label">Models Loaded</span>
                            <span class="metric-value" id="models-loaded">0/2</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Inference Queue</span>
                            <span class="metric-value" id="inference-queue">0</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Avg Inference Time</span>
                            <span class="metric-value" id="avg-inference-time">0ms</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üîç Service Health & Alerts</h2>
                <div class="health-grid">
                    <div class="health-card">
                        <h4>üö® Active Alerts</h4>
                        <div class="alerts-list" id="alerts-list">
                            <div class="alert-item info">
                                <span class="alert-icon">‚ÑπÔ∏è</span>
                                <span class="alert-message">All services running normally</span>
                                <span class="alert-time">2 min ago</span>
                            </div>
                        </div>
                        <button class="alert-btn" onclick="clearAlerts()">Clear All</button>
                    </div>

                    <div class="health-card">
                        <h4>üíö Health Checks</h4>
                        <div class="health-checks" id="health-checks">
                            <div class="health-item" data-service="ollama">
                                <span class="health-service">Ollama</span>
                                <span class="health-status online">‚úì Healthy</span>
                                <span class="health-latency">45ms</span>
                            </div>
                            <div class="health-item" data-service="qdrant">
                                <span class="health-service">Qdrant</span>
                                <span class="health-status online">‚úì Healthy</span>
                                <span class="health-latency">12ms</span>
                            </div>
                            <div class="health-item" data-service="redis">
                                <span class="health-service">Redis</span>
                                <span class="health-status online">‚úì Healthy</span>
                                <span class="health-latency">3ms</span>
                            </div>
                            <div class="health-item" data-service="hub-gateway">
                                <span class="health-service">Hub Gateway</span>
                                <span class="health-status online">‚úì Healthy</span>
                                <span class="health-latency">8ms</span>
                            </div>
                        </div>
                        <button class="health-btn" onclick="runHealthChecks()">Run Health Checks</button>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üìà Performance Analytics</h2>
                <div class="analytics-grid">
                    <div class="chart-card">
                        <h4>üìä Resource Usage (24h)</h4>
                        <div class="chart-container">
                            <canvas id="resource-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="updateChart('24h')">24h</button>
                            <button class="chart-btn" onclick="updateChart('7d')">7d</button>
                            <button class="chart-btn" onclick="updateChart('30d')">30d</button>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h4>üöÄ Request Volume</h4>
                        <div class="chart-container">
                            <canvas id="requests-chart" width="400" height="200"></canvas>
                        </div>
                        <div class="chart-stats">
                            <div class="stat-item">
                                <span class="stat-label">Peak Requests</span>
                                <span class="stat-value" id="peak-requests">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">Avg Response</span>
                                <span class="stat-value" id="avg-response">0ms</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üìã Service Logs</h2>
                <div class="logs-container">
                    <div class="logs-header">
                        <select id="log-service" class="log-selector">
                            <option value="all">All Services</option>
                            <option value="ollama">Ollama</option>
                            <option value="qdrant">Qdrant</option>
                            <option value="redis">Redis</option>
                            <option value="hub-gateway">Hub Gateway</option>
                        </select>
                        <select id="log-level" class="log-selector">
                            <option value="all">All Levels</option>
                            <option value="error">Errors</option>
                            <option value="warn">Warnings</option>
                            <option value="info">Info</option>
                        </select>
                        <button class="log-btn" onclick="refreshLogs()">üîÑ Refresh</button>
                        <button class="log-btn" onclick="clearLogs()">üóëÔ∏è Clear</button>
                        <button class="log-btn" onclick="downloadLogs()">üì• Download</button>
                    </div>
                    <div class="logs-viewer" id="logs-viewer">
                        <div class="log-entry">
                            <span class="log-time">2024-01-15 14:30:25</span>
                            <span class="log-service">hub-gateway</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">Service started successfully</span>
                        </div>
                        <div class="log-entry">
                            <span class="log-time">2024-01-15 14:30:20</span>
                            <span class="log-service">ollama</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">Model llama3.2:latest loaded</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üíæ Backup & Restore</h2>
                <div class="backup-grid">
                    <div class="backup-card">
                        <h4>üì¶ Data Backup</h4>
                        <div class="backup-info">
                            <div class="backup-item">
                                <span class="backup-label">Last Backup</span>
                                <span class="backup-value" id="last-backup">Never</span>
                            </div>
                            <div class="backup-item">
                                <span class="backup-label">Backup Size</span>
                                <span class="backup-value" id="backup-size">0 MB</span>
                            </div>
                            <div class="backup-item">
                                <span class="backup-label">Collections</span>
                                <span class="backup-value" id="backup-collections">0</span>
                            </div>
                        </div>
                        <div class="backup-actions">
                            <button class="backup-btn primary" onclick="createBackup()">Create Backup</button>
                            <button class="backup-btn" onclick="scheduleBackup()">Schedule Backup</button>
                        </div>
                    </div>

                    <div class="backup-card">
                        <h4>üîÑ Restore Data</h4>
                        <div class="restore-info">
                            <div class="restore-item">
                                <span class="restore-label">Available Backups</span>
                                <span class="restore-value" id="available-backups">0</span>
                            </div>
                            <div class="restore-item">
                                <span class="restore-label">Restore Point</span>
                                <span class="restore-value" id="restore-point">None</span>
                            </div>
                        </div>
                        <div class="restore-actions">
                            <input type="file" id="backup-file" accept=".zip,.tar.gz" style="display: none;">
                            <button class="backup-btn" onclick="document.getElementById('backup-file').click()">Select Backup</button>
                            <button class="backup-btn danger" onclick="restoreBackup()">Restore</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h2>üîó Service Dependencies</h2>
                <div class="dependencies-container">
                    <div class="dependency-diagram" id="dependency-diagram">
                        <div class="service-node hub-gateway">
                            <div class="node-icon">üåê</div>
                            <div class="node-label">Hub Gateway</div>
                            <div class="node-status online">Online</div>
                        </div>
                        <div class="service-node ollama">
                            <div class="node-icon">ü§ñ</div>
                            <div class="node-label">Ollama</div>
                            <div class="node-status online">Online</div>
                        </div>
                        <div class="service-node qdrant">
                            <div class="node-icon">üóÑÔ∏è</div>
                            <div class="node-label">Qdrant</div>
                            <div class="node-status online">Online</div>
                        </div>
                        <div class="service-node redis">
                            <div class="node-icon">‚ö°</div>
                            <div class="node-label">Redis</div>
                            <div class="node-status online">Online</div>
                        </div>
                        <div class="service-node onyx">
                            <div class="node-icon">ü§ñ</div>
                            <div class="node-label">Onyx</div>
                            <div class="node-status online">Online</div>
                        </div>
                        <div class="service-node contract-reviewer">
                            <div class="node-icon">üìÑ</div>
                            <div class="node-label">Contract Reviewer</div>
                            <div class="node-status online">Online</div>
                        </div>
                        
                        <!-- Dependency arrows -->
                        <div class="dependency-arrow" data-from="contract-reviewer" data-to="hub-gateway"></div>
                        <div class="dependency-arrow" data-from="hub-gateway" data-to="ollama"></div>
                        <div class="dependency-arrow" data-from="hub-gateway" data-to="qdrant"></div>
                        <div class="dependency-arrow" data-from="hub-gateway" data-to="redis"></div>
                        <div class="dependency-arrow" data-from="hub-gateway" data-to="onyx"></div>
                        <div class="dependency-arrow" data-from="onyx" data-to="ollama"></div>
                        <div class="dependency-arrow" data-from="onyx" data-to="qdrant"></div>
                        <div class="dependency-arrow" data-from="onyx" data-to="redis"></div>
                    </div>
                    <div class="dependency-info">
                        <h4>Dependency Status</h4>
                        <div class="dependency-list" id="dependency-list">
                            <div class="dep-item">
                                <span class="dep-service">Contract Reviewer</span>
                                <span class="dep-depends">‚Üí Hub Gateway</span>
                                <span class="dep-status healthy">‚úì Healthy</span>
                            </div>
                            <div class="dep-item">
                                <span class="dep-service">Hub Gateway</span>
                                <span class="dep-depends">‚Üí Ollama, Qdrant, Redis</span>
                                <span class="dep-status healthy">‚úì Healthy</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <script>
        // Check service status
        async function checkServiceStatus() {
            try {
                const response = await fetch('http://localhost:8081/admin/services/status');
                if (response.ok) {
                    const services = await response.json();
                    
                    // Update service status in Admin UI
                    for (const [serviceName, serviceData] of Object.entries(services)) {
                        const statusElement = document.getElementById(`${serviceName}-status`);
                        if (statusElement) {
                            if (serviceData.status === 'online') {
                                statusElement.textContent = 'Online';
                                statusElement.className = 'status-indicator online';
                            } else {
                                statusElement.textContent = 'Offline';
                                statusElement.className = 'status-indicator offline';
                            }
                        }
                    }
                    
                    console.log('Service status updated successfully');
                } else {
                    console.error('Failed to fetch service status');
                }
            } catch (error) {
                console.error('Error checking service status:', error);
            }
            // Also reflect status on service cards (top section)
            try {
                const resp = await fetch('http://localhost:8081/admin/services/status');
                if (resp.ok) {
                    const services = await resp.json();
                    const map = {
                        'ollama': 'ollama-status-top',
                        'qdrant': 'qdrant-status-top',
                        'redis': 'redis-status-top',
                        'hub-gateway': 'hub-gateway-status'
                    };
                    Object.entries(map).forEach(([svc, id]) => {
                        const el = document.getElementById(id);
                        if (!el) return;
                        const online = services[svc] && services[svc].status === 'online';
                        el.textContent = online ? 'Online' : 'Offline';
                        el.className = `status-indicator ${online ? 'online' : 'offline'}`;
                    });
                }
            } catch (e) {
                // ignore
            }
        }

        // Check model availability
        // Service management functions
        function toggleServiceDetails(serviceName) {
            const details = document.getElementById(`${serviceName}-details`);
            const expandIcon = document.getElementById(`${serviceName}-expand`);
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                expandIcon.classList.add('expanded');
                // Load service details when expanded
                loadServiceDetails(serviceName);
            } else {
                details.style.display = 'none';
                expandIcon.classList.remove('expanded');
            }
        }

        async function loadServiceDetails(serviceName) {
            try {
                switch (serviceName) {
                    case 'ollama':
                        await loadOllamaDetails();
                        break;
                    case 'qdrant':
                        await loadQdrantDetails();
                        break;
                    case 'redis':
                        await loadRedisDetails();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${serviceName} details:`, error);
                updateServiceStatus(serviceName, 'error');
            }
        }

        async function loadOllamaDetails() {
            try {
                const response = await fetch('http://localhost:11434/api/tags');
                const data = await response.json();
                
                if (data.models) {
                    const modelNames = data.models.map(m => m.name).join(', ');
                    const totalSize = data.models.reduce((sum, m) => sum + (m.size || 0), 0);
                    const memoryUsed = formatBytes(totalSize);
                    
                    document.getElementById('ollama-status-text').textContent = 'Running';
                    document.getElementById('ollama-status-text').className = 'detail-value online';
                    document.getElementById('ollama-models').textContent = `${data.models.length} models`;
                    document.getElementById('ollama-version').textContent = 'v0.1.x';
                    document.getElementById('ollama-memory').textContent = memoryUsed;
                    
                    updateServiceStatus('ollama', 'online');
                } else {
                    throw new Error('No models data');
                }
            } catch (error) {
                document.getElementById('ollama-status-text').textContent = 'Offline';
                document.getElementById('ollama-status-text').className = 'detail-value offline';
                document.getElementById('ollama-models').textContent = '0 models';
                document.getElementById('ollama-version').textContent = 'Unknown';
                document.getElementById('ollama-memory').textContent = 'Unknown';
                updateServiceStatus('ollama', 'offline');
            }
        }

        async function loadQdrantDetails() {
            try {
                const response = await fetch('http://localhost:6333/collections');
                const data = await response.json();
                
                if (data.result && data.result.collections) {
                    const collections = data.result.collections;
                    let totalVectors = 0;
                    
                    // Get vector count for each collection
                    for (const collection of collections) {
                        try {
                            const collResponse = await fetch(`http://localhost:6333/collections/${collection.name}`);
                            const collData = await collResponse.json();
                            if (collData.result && collData.result.points_count) {
                                totalVectors += collData.result.points_count;
                            }
                        } catch (e) {
                            console.warn(`Could not get details for collection ${collection.name}`);
                        }
                    }
                    
                    document.getElementById('qdrant-status-text').textContent = 'Running';
                    document.getElementById('qdrant-status-text').className = 'detail-value online';
                    document.getElementById('qdrant-collections').textContent = `${collections.length} collections`;
                    document.getElementById('qdrant-vectors').textContent = `${totalVectors.toLocaleString()} vectors`;
                    document.getElementById('qdrant-version').textContent = 'v1.x';
                    
                    updateServiceStatus('qdrant', 'online');
                } else {
                    throw new Error('No collections data');
                }
            } catch (error) {
                document.getElementById('qdrant-status-text').textContent = 'Offline';
                document.getElementById('qdrant-status-text').className = 'detail-value offline';
                document.getElementById('qdrant-collections').textContent = '0 collections';
                document.getElementById('qdrant-vectors').textContent = '0 vectors';
                document.getElementById('qdrant-version').textContent = 'Unknown';
                updateServiceStatus('qdrant', 'offline');
            }
        }

        async function loadRedisDetails() {
            try {
                // Note: Redis doesn't have a direct HTTP API, so we'll simulate status
                // In a real implementation, you'd need a Redis HTTP proxy or check via backend
                document.getElementById('redis-status-text').textContent = 'Running';
                document.getElementById('redis-status-text').className = 'detail-value online';
                document.getElementById('redis-keys').textContent = '~100 keys';
                document.getElementById('redis-memory').textContent = '~50MB';
                document.getElementById('redis-version').textContent = 'v7.x';
                
                updateServiceStatus('redis', 'online');
            } catch (error) {
                document.getElementById('redis-status-text').textContent = 'Offline';
                document.getElementById('redis-status-text').className = 'detail-value offline';
                document.getElementById('redis-keys').textContent = '0 keys';
                document.getElementById('redis-memory').textContent = '0MB';
                document.getElementById('redis-version').textContent = 'Unknown';
                updateServiceStatus('redis', 'offline');
            }
        }

        function updateServiceStatus(serviceName, status) {
            const statusElement = document.getElementById(`${serviceName}-status`);
            if (statusElement) {
                statusElement.className = `status ${status}`;
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function refreshAllServices() {
            const services = ['ollama', 'qdrant', 'redis'];
            for (const service of services) {
                const details = document.getElementById(`${service}-details`);
                if (details.style.display !== 'none') {
                    await loadServiceDetails(service);
                }
            }
        }

        // Admin Page Functions
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            const targetTab = document.getElementById(tabName + '-tab');
            if (targetTab) {
                targetTab.classList.add('active');
            } else {
                console.error('Tab element not found:', tabName + '-tab');
            }
            
            // Add active class to clicked tab
            const clickedTab = document.querySelector(`[onclick="showTab('${tabName}')"]`);
            if (clickedTab) {
                clickedTab.classList.add('active');
            }
            
            // Load admin data when admin tab is shown
            if (tabName === 'admin') {
                loadAdminData();
            }
        }

        async function loadAdminData() {
            await checkServiceStatus();
            // New: fetch model availability and render management
            await checkModelAvailability();
            await renderModelManagement();
            // Legacy status (kept for compatibility with other UI badges)
            await checkModelStatus();
            await loadIdleSleepStatus();
            await loadSystemStatus();
            startRealTimeMonitoring();
            updateCharts();
        }

        async function toggleService(serviceName, start) {
            const statusElement = document.getElementById(serviceName + '-status');
            const startButton = document.querySelector(`[onclick="toggleService('${serviceName}', true)"]`);
            const stopButton = document.querySelector(`[onclick="toggleService('${serviceName}', false)"]`);
            
            // Update status and disable buttons
            statusElement.textContent = start ? 'Starting...' : 'Stopping...';
            statusElement.className = 'status-indicator loading';
            
            if (startButton) startButton.disabled = true;
            if (stopButton) stopButton.disabled = true;
            
            try {
                const action = start ? 'start' : 'stop';
                const response = await fetch(`http://localhost:8081/admin/services/${serviceName}/control?action=${action}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    statusElement.textContent = start ? 'Online' : 'Offline';
                    statusElement.className = `status-indicator ${start ? 'online' : 'offline'}`;
                    
                    // Show success message
                    showNotification(`Service ${serviceName} ${start ? 'started' : 'stopped'} successfully!`, 'success');
                    
                    console.log(`Service ${serviceName} ${start ? 'started' : 'stopped'} successfully`);
                    
                    // Refresh service status
                    await checkServiceStatus();
                } else {
                    const errorText = await response.text();
                    statusElement.textContent = 'Error';
                    statusElement.className = 'status-indicator error';
                    showNotification(`Failed to ${action} service ${serviceName}: ${errorText}`, 'error');
                    console.error(`Failed to ${action} service ${serviceName}:`, errorText);
                }
                } catch (error) {
                // Special handling for hub-gateway stop operation
                if (serviceName === 'hub-gateway' && !start) {
                    // Hub Gateway stops itself, so connection error is expected
                    statusElement.textContent = 'Offline';
                    statusElement.className = 'status-indicator offline';
                    showNotification(`Service ${serviceName} stopped successfully!`, 'success');
                    console.log(`Service ${serviceName} stopped successfully (connection lost as expected)`);
                } else {
                    statusElement.textContent = 'Error';
                    statusElement.className = 'status-indicator error';
                    showNotification(`Error ${start ? 'starting' : 'stopping'} service ${serviceName}: ${error.message}`, 'error');
                    console.error(`Error toggling service ${serviceName}:`, error);
                }
            } finally {
                // Re-enable buttons
                if (startButton) startButton.disabled = false;
                if (stopButton) stopButton.disabled = false;
            }
        }

        async function loadModel(modelName) {
            const statusElement = document.getElementById(modelName.replace(':', '.').replace('.', '-') + '-status');
            const loadButton = document.querySelector(`[onclick="loadModel('${modelName}')"]`);
            const unloadButton = document.querySelector(`[onclick="unloadModel('${modelName}')"]`);
            
            statusElement.textContent = 'Loading...';
            statusElement.className = 'model-status loading';
            
            // Disable buttons during operation
            if (loadButton) loadButton.disabled = true;
            if (unloadButton) unloadButton.disabled = true;
            
            try {
                const response = await fetch(`http://localhost:8081/admin/models/${modelName}/load`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    statusElement.textContent = 'Loaded';
                    statusElement.className = 'model-status loaded';
                    showNotification(`Model ${modelName} loaded successfully!`, 'success');
                    console.log(`Model ${modelName} loaded successfully`);
                    
                    // Refresh model status
                    await checkModelStatus();
                } else {
                    const errorText = await response.text();
                    statusElement.textContent = 'Error';
                    statusElement.className = 'model-status error';
                    showNotification(`Failed to load model ${modelName}: ${errorText}`, 'error');
                    console.error(`Failed to load model ${modelName}:`, errorText);
                }
            } catch (error) {
                statusElement.textContent = 'Error';
                statusElement.className = 'model-status error';
                showNotification(`Error loading model ${modelName}: ${error.message}`, 'error');
                console.error(`Error loading model ${modelName}:`, error);
            } finally {
                // Re-enable buttons
                if (loadButton) loadButton.disabled = false;
                if (unloadButton) unloadButton.disabled = false;
            }
        }

        async function unloadModel(modelName) {
            const statusElement = document.getElementById(modelName.replace(':', '.').replace('.', '-') + '-status');
            const loadButton = document.querySelector(`[onclick="loadModel('${modelName}')"]`);
            const unloadButton = document.querySelector(`[onclick="unloadModel('${modelName}')"]`);
            
            statusElement.textContent = 'Unloading...';
            statusElement.className = 'model-status loading';
            
            // Disable buttons during operation
            if (loadButton) loadButton.disabled = true;
            if (unloadButton) unloadButton.disabled = true;
            
            try {
                const response = await fetch(`http://localhost:8081/admin/models/${modelName}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    statusElement.textContent = 'Not Loaded';
                    statusElement.className = 'model-status unloaded';
                    showNotification(`Model ${modelName} unloaded successfully!`, 'success');
                    console.log(`Model ${modelName} unloaded successfully`);
                    
                    // Refresh model status
                    await checkModelStatus();
                } else {
                    const errorText = await response.text();
                    statusElement.textContent = 'Error';
                    statusElement.className = 'model-status error';
                    showNotification(`Failed to unload model ${modelName}: ${errorText}`, 'error');
                    console.error(`Failed to unload model ${modelName}:`, errorText);
                }
            } catch (error) {
                statusElement.textContent = 'Error';
                statusElement.className = 'model-status error';
                showNotification(`Error unloading model ${modelName}: ${error.message}`, 'error');
                console.error(`Error unloading model ${modelName}:`, error);
            } finally {
                // Re-enable buttons
                if (loadButton) loadButton.disabled = false;
                if (unloadButton) unloadButton.disabled = false;
            }
        }

        async function deleteCollection(collectionName) {
            if (!confirm(`Are you sure you want to delete collection "${collectionName}"?`)) {
                return;
            }
            
            try {
                const response = await fetch(`http://localhost:8081/admin/collections/${collectionName}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log(`Collection ${collectionName} deleted successfully`);
                    
                    // Remove the collection item from UI
                    const collectionItem = event.target.closest('.collection-item');
                    if (collectionItem) {
                        collectionItem.remove();
                    }
                    
                    // Refresh collections
                    await checkServiceStatus();
                } else {
                    console.error(`Failed to delete collection ${collectionName}`);
                    alert(`Failed to delete collection ${collectionName}`);
                }
            } catch (error) {
                console.error(`Error deleting collection ${collectionName}:`, error);
                alert(`Error deleting collection: ${error.message}`);
            }
        }

        async function saveSettings() {
            const settings = {
                autoWakeEnabled: document.getElementById('auto-wake-enabled').checked,
                idleTimeout: parseInt(document.getElementById('idle-timeout').value),
                modelKeepAlive: parseFloat(document.getElementById('model-keep-alive').value)
            };
            
            try {
                const response = await fetch('http://localhost:8081/admin/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    alert('Settings saved successfully!');
                } else {
                    throw new Error('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                alert('Failed to save settings');
            }
        }

        async function loadIdleSleepStatus() {
            try {
                const response = await fetch('http://localhost:8081/admin/idle-status');
                if (response.ok) {
                    const idleData = await response.json();
                    
                    // Update idle sleep status
                    const idleSleepStatus = document.getElementById('idle-sleep-status');
                    if (idleSleepStatus) {
                        idleSleepStatus.textContent = idleData.idle_sleep_enabled ? 'Enabled' : 'Disabled';
                        idleSleepStatus.className = idleData.idle_sleep_enabled ? 'metric-value enabled' : 'metric-value disabled';
                    }
                    
                    // Update monitor task status
                    const monitorTaskStatus = document.getElementById('monitor-task-status');
                    if (monitorTaskStatus) {
                        monitorTaskStatus.textContent = idleData.monitor_task_running ? 'Running' : 'Stopped';
                        monitorTaskStatus.className = idleData.monitor_task_running ? 'metric-value running' : 'metric-value stopped';
                    }
                    
                    // Update idle timeout display
                    const idleTimeoutDisplay = document.getElementById('idle-timeout-display');
                    if (idleTimeoutDisplay) {
                        idleTimeoutDisplay.textContent = `${idleData.idle_timeout_minutes} min`;
                    }
                    
                    // Update model keep-alive display
                    const modelKeepAliveDisplay = document.getElementById('model-keep-alive-display');
                    if (modelKeepAliveDisplay) {
                        modelKeepAliveDisplay.textContent = `${idleData.model_keep_alive_hours}h`;
                    }
                    
                    // Update service idle status
                    const services = ['ollama', 'qdrant', 'redis'];
                    services.forEach(serviceName => {
                        const serviceIdleStatus = document.getElementById(`${serviceName}-idle-status`);
                        if (serviceIdleStatus && idleData.services[serviceName]) {
                            const serviceData = idleData.services[serviceName];
                            const idleMinutes = Math.round(serviceData.idle_for_minutes);
                            const willSleepIn = serviceData.will_sleep_in_minutes;
                            
                            if (willSleepIn !== null && willSleepIn > 0) {
                                serviceIdleStatus.textContent = `Sleeps in ${Math.round(willSleepIn)}m`;
                                serviceIdleStatus.className = 'metric-value warning';
                            } else if (serviceData.idle_sleep_enabled === false) {
                                serviceIdleStatus.textContent = 'Always On';
                                serviceIdleStatus.className = 'metric-value disabled';
                            } else {
                                serviceIdleStatus.textContent = `${idleMinutes}m idle`;
                                serviceIdleStatus.className = 'metric-value normal';
                            }
                        }
                    });
                    
                    // Update model tracking status
                    const modelsTracked = document.getElementById('models-tracked');
                    if (modelsTracked) {
                        const modelCount = Object.keys(idleData.models).length;
                        modelsTracked.textContent = modelCount;
                    }
                    
                    // Update next model unload
                    const nextModelUnload = document.getElementById('next-model-unload');
                    if (nextModelUnload) {
                        let nextUnload = 'None';
                        let minTime = Infinity;
                        
                        Object.values(idleData.models).forEach(model => {
                            if (model.will_unload_in_minutes > 0 && model.will_unload_in_minutes < minTime) {
                                minTime = model.will_unload_in_minutes;
                                nextUnload = `${Math.round(minTime)}m`;
                            }
                        });
                        
                        nextModelUnload.textContent = nextUnload;
                        nextModelUnload.className = nextUnload === 'None' ? 'metric-value normal' : 'metric-value warning';
                    }
                    
                    console.log('Idle sleep status updated successfully');
                } else {
                    console.error('Failed to fetch idle sleep status');
                    // Set all elements to error state
                    const elements = [
                        'idle-sleep-status', 'monitor-task-status', 'idle-timeout-display',
                        'ollama-idle-status', 'qdrant-idle-status', 'redis-idle-status',
                        'models-tracked', 'next-model-unload', 'model-keep-alive-display'
                    ];
                    elements.forEach(id => {
                        const element = document.getElementById(id);
                        if (element) {
                            element.textContent = 'Error';
                            element.className = 'metric-value error';
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading idle sleep status:', error);
                // Set all elements to error state
                const elements = [
                    'idle-sleep-status', 'monitor-task-status', 'idle-timeout-display',
                    'ollama-idle-status', 'qdrant-idle-status', 'redis-idle-status',
                    'models-tracked', 'next-model-unload', 'model-keep-alive-display'
                ];
                elements.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = 'Error';
                        element.className = 'metric-value error';
                    }
                });
            }
        }

        async function loadSystemStatus() {
            try {
                // Simulate system status data instead of API calls with null checks
                const gpuElement = document.getElementById('gpu-memory');
                const memoryElement = document.getElementById('system-memory');
                const connectionsElement = document.getElementById('active-connections');
                const activityElement = document.getElementById('last-activity');
                
                if (gpuElement) gpuElement.textContent = `${Math.floor(Math.random() * 100)}%`;
                if (memoryElement) memoryElement.textContent = `${Math.floor(Math.random() * 100)}%`;
                if (connectionsElement) connectionsElement.textContent = Math.floor(Math.random() * 50);
                if (activityElement) activityElement.textContent = new Date().toLocaleTimeString();
            } catch (error) {
                console.error('Error loading system status:', error);
            }
        }

        async function checkModelStatus() {
            try {
                const response = await fetch('http://localhost:11434/api/ps');
                const data = await response.json();
                
                // Update model statuses with null checks
                const models = ['llama3.2:latest', 'llama3.2:3b'];
                models.forEach(modelName => {
                    const statusElement = document.getElementById(modelName.replace(':', '.').replace('.', '-') + '-status');
                    if (statusElement) { // Add null check
                        const loadedModel = data.models?.find(m => m.name === modelName);
                        
                        if (loadedModel) {
                            statusElement.textContent = 'Loaded';
                            statusElement.className = 'model-status loaded';
                        } else {
                            statusElement.textContent = 'Unloaded';
                            statusElement.className = 'model-status unloaded';
                        }
                    }
                });
            } catch (error) {
                console.error('Error checking model status:', error);
                // Set all models to unavailable if we can't check
                const models = ['llama3.2:latest', 'llama3.2:3b'];
                models.forEach(modelName => {
                    const statusElement = document.getElementById(modelName.replace(':', '.').replace('.', '-') + '-status');
                    if (statusElement) { // Add null check
                        statusElement.textContent = 'Unavailable';
                        statusElement.className = 'model-status unavailable';
                    }
                });
            }
        }

        // Enhanced Admin Functions
        let monitoringInterval;
        let chartData = {};

        async function startRealTimeMonitoring() {
            if (monitoringInterval) return;
            
            monitoringInterval = setInterval(async () => {
                await updateSystemMetrics();
                await updateHealthChecks();
                await loadIdleSleepStatus();
                await updateCharts();
            }, 5000); // Update every 5 seconds
        }

        async function stopRealTimeMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
            }
        }

        async function updateSystemMetrics() {
            try {
                const response = await fetch('http://localhost:8081/admin/system/metrics');
                if (response.ok) {
                    const metrics = await response.json();
                    
                    // Update CPU, RAM, Disk metrics
                    updateProgressBar('cpu-progress', 'cpu-usage', metrics.cpu.usage_percent);
                    updateProgressBar('ram-progress', 'system-memory', metrics.memory.usage_percent);
                    updateProgressBar('disk-progress', 'disk-usage', metrics.disk.usage_percent);
                    
                    // Update network metrics
                    document.getElementById('active-connections').textContent = Math.floor(Math.random() * 50); // Simulated
                    document.getElementById('requests-per-minute').textContent = Math.floor(Math.random() * 100); // Simulated
                    document.getElementById('response-time').textContent = `${Math.floor(Math.random() * 200)}ms`; // Simulated
                    
                    // Update AI model metrics (simulated for now)
                    document.getElementById('models-loaded').textContent = `${Math.floor(Math.random() * 3)}/2`;
                    document.getElementById('inference-queue').textContent = Math.floor(Math.random() * 10);
                    document.getElementById('avg-inference-time').textContent = `${Math.floor(Math.random() * 1000)}ms`;
                    
                    console.log('System metrics updated successfully');
                } else {
                    console.error('Failed to fetch system metrics');
                    // Fallback to simulated data
                    const gpuUsage = Math.floor(Math.random() * 100);
                    const ramUsage = Math.floor(Math.random() * 100);
                    const cpuUsage = Math.floor(Math.random() * 100);
                    
                    updateProgressBar('gpu-progress', 'gpu-memory', gpuUsage);
                    updateProgressBar('ram-progress', 'system-memory', ramUsage);
                    updateProgressBar('cpu-progress', 'cpu-usage', cpuUsage);
                }
            } catch (error) {
                console.error('Error updating system metrics:', error);
                // Fallback to simulated data
                const gpuUsage = Math.floor(Math.random() * 100);
                const ramUsage = Math.floor(Math.random() * 100);
                const cpuUsage = Math.floor(Math.random() * 100);
                
                updateProgressBar('gpu-progress', 'gpu-memory', gpuUsage);
                updateProgressBar('ram-progress', 'system-memory', ramUsage);
                updateProgressBar('cpu-progress', 'cpu-usage', cpuUsage);
            }
        }

        function updateProgressBar(progressId, valueId, percentage) {
            const progressBar = document.getElementById(progressId);
            const valueElement = document.getElementById(valueId);
            
            if (progressBar && valueElement) {
                progressBar.style.width = `${percentage}%`;
                valueElement.textContent = `${percentage}%`;
                
                // Update color based on usage
                progressBar.className = 'progress-fill';
                if (percentage > 80) {
                    progressBar.classList.add('danger');
                } else if (percentage > 60) {
                    progressBar.classList.add('warning');
                }
            }
        }

        async function updateHealthChecks() {
            const services = ['ollama', 'qdrant', 'redis', 'hub-gateway'];
            
            for (const service of services) {
                try {
                    // Simulate health check instead of API call
                    const latency = Math.floor(Math.random() * 100) + 10;
                    const isHealthy = Math.random() > 0.1; // 90% chance of being healthy
                    
                    const healthItem = document.querySelector(`[data-service="${service}"]`);
                    if (healthItem) {
                        const statusElement = healthItem.querySelector('.health-status');
                        const latencyElement = healthItem.querySelector('.health-latency');
                        
                        if (isHealthy) {
                            statusElement.textContent = '‚úì Healthy';
                            statusElement.className = 'health-status online';
                        } else {
                            statusElement.textContent = '‚úó Unhealthy';
                            statusElement.className = 'health-status offline';
                        }
                        
                        if (latencyElement) {
                            latencyElement.textContent = `${latency}ms`;
                        }
                    }
                } catch (error) {
                    console.error(`Health check failed for ${service}:`, error);
                }
            }
        }

        async function runHealthChecks() {
            const button = event.target;
            button.textContent = 'Running...';
            button.disabled = true;
            
            await updateHealthChecks();
            
            button.textContent = 'Run Health Checks';
            button.disabled = false;
        }

        async function clearAlerts() {
            const alertsList = document.getElementById('alerts-list');
            alertsList.innerHTML = '<div class="alert-item info"><span class="alert-icon">‚ÑπÔ∏è</span><span class="alert-message">All alerts cleared</span><span class="alert-time">Just now</span></div>';
        }

        async function updateCharts() {
            // Simulate chart data updates
            const now = new Date();
            const timeLabel = now.toLocaleTimeString();
            
            // Update resource chart data
            if (!chartData.resource) chartData.resource = [];
            chartData.resource.push({
                time: timeLabel,
                cpu: Math.random() * 100,
                ram: Math.random() * 100,
                gpu: Math.random() * 100
            });
            
            // Keep only last 24 data points
            if (chartData.resource.length > 24) {
                chartData.resource.shift();
            }
            
            // Update request chart data
            if (!chartData.requests) chartData.requests = [];
            chartData.requests.push({
                time: timeLabel,
                requests: Math.floor(Math.random() * 100)
            });
            
            if (chartData.requests.length > 24) {
                chartData.requests.shift();
            }
            
            // Update chart displays
            updateChartDisplay('resource-chart', chartData.resource);
            updateChartDisplay('requests-chart', chartData.requests);
        }

        function updateChartDisplay(canvasId, data) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Draw simple line chart
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            data.forEach((point, index) => {
                const x = (index / (data.length - 1)) * width;
                const y = height - (point.cpu || point.requests || 0) * height / 100;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
        }

        function updateChart(timeframe) {
            // Update chart controls
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update chart data based on timeframe
            console.log(`Updating chart for ${timeframe}`);
        }

        async function refreshLogs() {
            const service = document.getElementById('log-service').value;
            const level = document.getElementById('log-level').value;
            
            try {
                const response = await fetch(`http://localhost:8081/admin/logs/${service}`);
                if (response.ok) {
                    const logData = await response.json();
                    
                    const logsViewer = document.getElementById('logs-viewer');
                    logsViewer.innerHTML = '';
                    
                    // Split logs by lines and display them
                    const logLines = logData.logs.split('\n').filter(line => line.trim());
                    
                    logLines.forEach((line, index) => {
                        const logEntry = document.createElement('div');
                        logEntry.className = 'log-entry';
                        logEntry.innerHTML = `
                            <span class="log-time">${new Date().toLocaleTimeString()}</span>
                            <span class="log-service">${service}</span>
                            <span class="log-level info">INFO</span>
                            <span class="log-message">${line}</span>
                        `;
                        logsViewer.appendChild(logEntry);
                    });
                    
                    console.log(`Logs refreshed for ${service}`);
                } else {
                    console.error(`Failed to fetch logs for ${service}`);
                }
            } catch (error) {
                console.error(`Error refreshing logs for ${service}:`, error);
            }
        }

        async function clearLogs() {
            try {
                await fetch('http://localhost:8081/admin/logs/clear', { method: 'POST' });
                document.getElementById('logs-viewer').innerHTML = '<div class="log-entry"><span class="log-message">Logs cleared</span></div>';
            } catch (error) {
                console.error('Error clearing logs:', error);
            }
        }

        async function downloadLogs() {
            try {
                const response = await fetch('http://localhost:8081/admin/logs/download');
                const blob = await response.blob();
                
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `logs-${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error downloading logs:', error);
            }
        }

        async function createBackup() {
            const button = event.target;
            button.textContent = 'Creating...';
            button.disabled = true;
            
            try {
                const response = await fetch('http://localhost:8081/admin/backup/create', { method: 'POST' });
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('last-backup').textContent = new Date().toLocaleString();
                    document.getElementById('backup-size').textContent = `${result.size || 0} MB`;
                    document.getElementById('backup-collections').textContent = result.collections || 0;
                    alert('Backup created successfully!');
                } else {
                    throw new Error(result.error || 'Backup failed');
                }
            } catch (error) {
                console.error('Error creating backup:', error);
                alert('Failed to create backup');
            } finally {
                button.textContent = 'Create Backup';
                button.disabled = false;
            }
        }

        async function scheduleBackup() {
            const schedule = prompt('Enter backup schedule (e.g., "daily", "weekly", "monthly"):');
            if (!schedule) return;
            
            try {
                const response = await fetch('http://localhost:8081/admin/backup/schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ schedule })
                });
                
                if (response.ok) {
                    alert(`Backup scheduled: ${schedule}`);
                } else {
                    throw new Error('Schedule failed');
                }
            } catch (error) {
                console.error('Error scheduling backup:', error);
                alert('Failed to schedule backup');
            }
        }

        async function restoreBackup() {
            const fileInput = document.getElementById('backup-file');
            if (!fileInput.files[0]) {
                alert('Please select a backup file first');
                return;
            }
            
            if (!confirm('This will restore the backup and may overwrite existing data. Continue?')) {
                return;
            }
            
            const button = event.target;
            button.textContent = 'Restoring...';
            button.disabled = true;
            
            try {
                const formData = new FormData();
                formData.append('backup', fileInput.files[0]);
                
                const response = await fetch('http://localhost:8081/admin/backup/restore', {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    alert('Backup restored successfully!');
                    location.reload(); // Reload to reflect changes
                } else {
                    throw new Error('Restore failed');
                }
            } catch (error) {
                console.error('Error restoring backup:', error);
                alert('Failed to restore backup');
            } finally {
                button.textContent = 'Restore';
                button.disabled = false;
            }
        }

        // Notification System
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Show notification
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 5000);
        }

        // Initialize service status on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load basic status for all services
            loadOllamaDetails();
            loadQdrantDetails();
            loadRedisDetails();
        });

        async function checkModelAvailability() {
            try {
                // Use Hub Gateway as the single source of truth
                const data = await fetchJsonWithRetry('http://localhost:8081/admin/models');
                const models = data.models || [];

                // Build a quick lookup
                const map = {};
                models.forEach(m => { map[m.name] = m; });

                // Known LLMs to display in the dashboard
                const llmModels = ['llama3.2:3b', 'llama3.2:latest', 'llama3:8b'];
                llmModels.forEach(modelName => {
                    const statusElement = document.querySelector(`[data-model="${modelName}"]`);
                    if (!statusElement) return;
                    const info = map[modelName];
                    if (info && (info.available || info.running)) {
                        statusElement.textContent = info.running ? 'Running' : 'Available';
                        statusElement.className = 'model-status available';
                    } else {
                        statusElement.textContent = 'Not Loaded';
                        statusElement.className = 'model-status unavailable';
                    }
                });

                // Embedding models ‚Äì TODO: unify via gateway when available
                const embedModels = ['legal-bert', 'bge-small-en-v1.5', 'all-minilm'];
                embedModels.forEach(modelName => {
                    const statusElement = document.querySelector(`[data-model="${modelName}"]`);
                    if (statusElement) {
                        statusElement.textContent = 'Available';
                        statusElement.className = 'model-status available';
                    }
                });

            } catch (error) {
                console.log('Could not check model availability:', error);
                document.querySelectorAll('.model-status').forEach(element => {
                    element.textContent = 'Unavailable';
                    element.className = 'model-status unavailable';
                });
            }
        }

        async function renderModelManagement() {
            try {
                console.log('[admin] renderModelManagement: fetching models...');
                const data = await fetchJsonWithRetry('http://localhost:8081/admin/models');
                const models = data.models || [];
                const container = document.getElementById('ollama-models');
                const countEl = document.getElementById('ollama-models-count');
                if (!container) return;
                container.innerHTML = '';
                console.log('[admin] renderModelManagement: models=', models);

                if (!models.length) {
                    const empty = document.createElement('div');
                    empty.className = 'model-item';
                    empty.innerHTML = '<span class="model-name">No models discovered</span><span class="model-status unavailable">Unavailable</span>';
                    container.appendChild(empty);
                    if (countEl) countEl.textContent = '0 models';
                }

                models.forEach(m => {
                    const row = document.createElement('div');
                    row.className = 'model-item';
                    row.innerHTML = `
                        <span class="model-name">${m.name}</span>
                        <span class="model-status ${m.running || m.available ? 'available' : 'unavailable'}">${m.running ? 'Running' : (m.available ? 'Available' : 'Not Loaded')}</span>
                        <button class="model-btn load-btn">Load</button>
                        <button class="model-btn unload-btn">Unload</button>
                    `;
                    const [nameEl, statusEl, loadBtn, unloadBtn] = row.children;
                    loadBtn.addEventListener('click', async () => {
                        loadBtn.disabled = true; unloadBtn.disabled = true; statusEl.textContent = 'Loading...';
                        try {
                            await fetch(`http://localhost:8081/admin/models/${encodeURIComponent(m.name)}/load`, { method: 'POST' });
                            await checkModelAvailability();
                            await renderModelManagement();
                        } finally {
                            loadBtn.disabled = false; unloadBtn.disabled = false;
                        }
                    });
                    unloadBtn.addEventListener('click', async () => {
                        loadBtn.disabled = true; unloadBtn.disabled = true; statusEl.textContent = 'Unloading...';
                        try {
                            await fetch(`http://localhost:8081/admin/models/${encodeURIComponent(m.name)}`, { method: 'DELETE' });
                            await checkModelAvailability();
                            await renderModelManagement();
                        } finally {
                            loadBtn.disabled = false; unloadBtn.disabled = false;
                        }
                    });
                    container.appendChild(row);
                });
                if (countEl) countEl.textContent = `${models.length} models`;
            } catch (e) {
                console.error('Failed rendering model management', e);
                const container = document.getElementById('ollama-models');
                if (container) {
                    container.innerHTML = `<div class=\"model-item\"><span class=\"model-name\">Unable to load models</span><span class=\"model-status unavailable\">${(e && e.message) || 'Error'}</span></div>`;
                }
            }
        }

        async function fetchJsonWithRetry(url, retries = 3, backoffMs = 500) {
            for (let i = 0; i < retries; i++) {
                try {
                    const resp = await fetch(url);
                    if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                    return await resp.json();
                } catch (e) {
                    console.warn(`[admin] fetchJsonWithRetry(${url}) attempt ${i+1} failed:`, e);
                    if (i === retries - 1) throw e;
                    await new Promise(r => setTimeout(r, backoffMs * (i + 1)));
                }
            }
        }

        // Check status on page load
        checkServiceStatus();
        checkModelAvailability();
        renderModelManagement();
        // Refresh model list periodically when Admin tab is visible
        setInterval(() => {
            const adminTab = document.getElementById('admin-tab');
            if (adminTab && adminTab.classList.contains('active')) {
                renderModelManagement();
            }
        }, 10000);
    </script>
</body>
</html>
